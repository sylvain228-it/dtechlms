import{r as _,j as u,c as le}from"./app-CjIWy3eH.js";import{a as Re,o as ze,b as Ce,L as _e,n as Se,C as je}from"./content-editable-BWYCC2c_.js";import{r as me,t as Ne,X as De,j as ge,a as he,R as pe,b as Me,u as Le,o as $e,L as ae,x as oe,w as be,y as Pe,U as ke,E as We,z as Z,c as Ie,d as He,O as Xe,I as Te,s as Ae,i as Ke,e as we,f as fe,h as Oe,k as Be,D as Ue}from"./nodes-B8QjlgCe.js";import{B as Ge}from"./button-CExzQmZc.js";import"./app-DfLmVDUM.js";import"./index-DnZUlvAx.js";import"./index-C4soMqjN.js";import"./index-BnYBuebb.js";import"./utils-AnTb9DBe.js";const xe=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],ye=xe[Math.floor(Math.random()*xe.length)],ve=_.createContext(null);function Ye(){return{color:ye[1],isCollabActive:!1,name:ye[0],yjsDocMap:new Map}}const Fe=Ye();function qe(r,e){let d=_.useContext(ve);return d==null&&(function(L,...p){const w=new URL("https://lexical.dev/docs/error"),x=new URLSearchParams;x.append("code",L);for(const h of p)x.append("v",h);w.search=x.toString(),console.warn(`Minified Lexical warning #${L}; visit ${w.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(319),d=d??Fe,d}function Ve({initialEditor:r,children:e,initialNodes:d,initialTheme:L,skipCollabChecks:p,skipEditableListener:w}){const x=_.useRef(!1),h=_.useContext(me);h==null&&(function(m,...i){const c=new URL("https://lexical.dev/docs/error"),D=new URLSearchParams;D.append("code",m);for(const t of i)D.append("v",t);throw c.search=D.toString(),Error(`Minified Lexical error #${m}; visit ${c.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(9);const[b,{getTheme:y}]=h,E=_.useMemo(()=>{const m=L||y()||void 0,i=Ne(h,m);m!==void 0&&(r._config.theme=m),r._parentEditor=r._parentEditor||b;const c=r._createEditorArgs,D=c&&c.namespace;if(d){D||(r._config.namespace=b._config.namespace);for(let t of d){let v=null,M=null;if(typeof t!="function"){const $=t;t=$.replace,v=$.with,M=$.withKlass||null}const G=De(r,t.getType());r._nodes.set(t.getType(),{exportDOM:G?G.exportDOM:void 0,klass:t,replace:v,replaceWithKlass:M,sharedNodeState:he(t),transforms:ge(t)})}}else if(c&&c.nodes)D||(r._config.namespace=b._config.namespace);else{const t=r._nodes=new Map(b._nodes);D||(r._config.namespace=b._config.namespace);for(const[v,M]of t)r._nodes.set(v,{exportDOM:M.exportDOM,klass:M.klass,replace:M.replace,replaceWithKlass:M.replaceWithKlass,sharedNodeState:he(M.klass),transforms:ge(M.klass)})}return[r,i]},[]),S=_.useContext(ve),{isCollabActive:j,yjsDocMap:T}=S??{},f=p||x.current||T&&T.has(r.getKey());return _.useEffect(()=>{f&&(x.current=!0)},[f]),_.useEffect(()=>{if(!w){const m=i=>r.setEditable(i);return m(b.isEditable()),b.registerEditableListener(m)}},[r,b,w]),u.jsx(me.Provider,{value:E,children:!j||f?e:null})}function ue(r,e,d){return Math.min(Math.max(r,e),d)}const l={east:1,north:8,south:2,west:4};function Ze(r){const e=le.c(51),{onResizeStart:d,onResizeEnd:L,buttonRef:p,imageRef:w,maxWidth:x,editor:h,showCaption:b,setShowCaption:y,captionsEnabled:E}=r,S=_.useRef(null);let j;e[0]===Symbol.for("react.memo_cache_sentinel")?(j={priority:"",value:"default"},e[0]=j):j=e[0];const T=_.useRef(j);let f;e[1]===Symbol.for("react.memo_cache_sentinel")?(f={currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0},e[1]=f):f=e[1];const m=_.useRef(f);let i,c,D;e[2]!==h||e[3]!==x?(i=h.getRootElement(),c=x||(i!==null?i.getBoundingClientRect().width-20:100),D=i!==null?i.getBoundingClientRect().height-20:100,e[2]=h,e[3]=x,e[4]=i,e[5]=c,e[6]=D):(i=e[4],c=e[5],D=e[6]);const t=D;let v;e[7]!==i?(v=s=>{const q=s===l.east||s===l.west,N=s===l.north||s===l.south,a=s&l.north&&s&l.west||s&l.south&&s&l.east,n=q?"ew":N?"ns":a?"nwse":"nesw";i!==null&&i.style.setProperty("cursor",`${n}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${n}-resize`,"important"),T.current.value=document.body.style.getPropertyValue("-webkit-user-select"),T.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},e[7]=i,e[8]=v):v=e[8];const M=v;let G;e[9]!==i?(G=()=>{i!==null&&i.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",T.current.value,T.current.priority))},e[9]=i,e[10]=G):G=e[10];const $=G;let o;if(e[11]!==h||e[12]!==w||e[13]!==t||e[14]!==c||e[15]!==L||e[16]!==d||e[17]!==$||e[18]!==M){o=(N,a)=>{if(!h.isEditable())return;const n=w.current,U=S.current;if(n!==null&&U!==null){N.preventDefault();const{width:H,height:X}=n.getBoundingClientRect(),R=pe(n),g=m.current;g.startWidth=H,g.startHeight=X,g.ratio=H/X,g.currentWidth=H,g.currentHeight=X,g.startX=N.clientX/R,g.startY=N.clientY/R,g.isResizing=!0,g.direction=a,M(a),d(),U.classList.add("touch-action-none"),n.style.height=`${X}px`,n.style.width=`${H}px`,document.addEventListener("pointermove",s),document.addEventListener("pointerup",q)}};const s=N=>{const a=w.current,n=m.current,U=n.direction&(l.east|l.west),H=n.direction&(l.south|l.north);if(a!==null&&n.isResizing){const X=pe(a);if(U&&H){let R=Math.floor(n.startX-N.clientX/X);R=n.direction&l.east?-R:R;const g=ue(n.startWidth+R,100,c),J=g/n.ratio;a.style.width=`${g}px`,a.style.height=`${J}px`,n.currentHeight=J,n.currentWidth=g}else if(H){let R=Math.floor(n.startY-N.clientY/X);R=n.direction&l.south?-R:R;const g=ue(n.startHeight+R,100,t);a.style.height=`${g}px`,n.currentHeight=g}else{let R=Math.floor(n.startX-N.clientX/X);R=n.direction&l.east?-R:R;const g=ue(n.startWidth+R,100,c);a.style.width=`${g}px`,n.currentWidth=g}}},q=()=>{const N=w.current,a=m.current,n=S.current;if(N!==null&&n!==null&&a.isResizing){const U=a.currentWidth,H=a.currentHeight;a.startWidth=0,a.startHeight=0,a.ratio=0,a.startX=0,a.startY=0,a.currentWidth=0,a.currentHeight=0,a.isResizing=!1,n.classList.remove("touch-action-none"),$(),L(U,H),document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",q)}};e[11]=h,e[12]=w,e[13]=t,e[14]=c,e[15]=L,e[16]=d,e[17]=$,e[18]=M,e[19]=o}else o=e[19];let V;e[20]!==p||e[21]!==E||e[22]!==y||e[23]!==b?(V=!b&&E&&u.jsx(Ge,{className:"image-caption-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:p,variant:"outline",onClick:()=>{y(!b)},children:"Add Caption"}),e[20]=p,e[21]=E,e[22]=y,e[23]=b,e[24]=V):V=e[24];let A;e[25]!==o?(A=u.jsx("div",{className:"image-resizer image-resizer-n absolute -top-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize bg-primary",onPointerDown:s=>{o(s,l.north)}}),e[25]=o,e[26]=A):A=e[26];let P;e[27]!==o?(P=u.jsx("div",{className:"image-resizer image-resizer-ne absolute -top-2.5 -right-2.5 h-2 w-2 cursor-nesw-resize bg-primary",onPointerDown:s=>{o(s,l.north|l.east)}}),e[27]=o,e[28]=P):P=e[28];let K;e[29]!==o?(K=u.jsx("div",{className:"image-resizer image-resizer-e absolute top-1/2 -right-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize bg-primary",onPointerDown:s=>{o(s,l.east)}}),e[29]=o,e[30]=K):K=e[30];let W;e[31]!==o?(W=u.jsx("div",{className:"image-resizer image-resizer-se absolute -right-2.5 -bottom-2.5 h-2 w-2 cursor-nwse-resize bg-primary",onPointerDown:s=>{o(s,l.south|l.east)}}),e[31]=o,e[32]=W):W=e[32];let O;e[33]!==o?(O=u.jsx("div",{className:"image-resizer image-resizer-s absolute -bottom-2.5 left-1/2 h-2 w-2 -translate-x-1/2 cursor-ns-resize bg-primary",onPointerDown:s=>{o(s,l.south)}}),e[33]=o,e[34]=O):O=e[34];let I;e[35]!==o?(I=u.jsx("div",{className:"image-resizer image-resizer-sw absolute -bottom-2.5 -left-2.5 h-2 w-2 cursor-nesw-resize bg-primary",onPointerDown:s=>{o(s,l.south|l.west)}}),e[35]=o,e[36]=I):I=e[36];let B;e[37]!==o?(B=u.jsx("div",{className:"image-resizer image-resizer-w absolute top-1/2 -left-2.5 h-2 w-2 -translate-y-1/2 cursor-ew-resize bg-primary",onPointerDown:s=>{o(s,l.west)}}),e[37]=o,e[38]=B):B=e[38];let k;e[39]!==o?(k=u.jsx("div",{className:"image-resizer image-resizer-nw absolute -top-2.5 -left-2.5 h-2 w-2 cursor-nwse-resize bg-primary",onPointerDown:s=>{o(s,l.north|l.west)}}),e[39]=o,e[40]=k):k=e[40];let F;return e[41]!==W||e[42]!==O||e[43]!==I||e[44]!==B||e[45]!==k||e[46]!==V||e[47]!==A||e[48]!==P||e[49]!==K?(F=u.jsxs("div",{ref:S,children:[V,A,P,K,W,O,I,B,k]}),e[41]=W,e[42]=O,e[43]=I,e[44]=B,e[45]=k,e[46]=V,e[47]=A,e[48]=P,e[49]=K,e[50]=F):F=e[50],F}const de=new Set,Ee=Me("RIGHT_CLICK_IMAGE_COMMAND");function Je(r){if(!de.has(r))throw new Promise(e=>{const d=new Image;d.src=r,d.onload=()=>{de.add(r),e(null)},d.onerror=()=>{de.add(r)}})}function Qe(r){const e=le.c(11),{altText:d,className:L,imageRef:p,src:w,width:x,height:h,maxWidth:b,onError:y}=r;Je(w);const E=L||void 0;let S;e[0]!==h||e[1]!==b||e[2]!==x?(S={height:h,maxWidth:b,width:x},e[0]=h,e[1]=b,e[2]=x,e[3]=S):S=e[3];let j;return e[4]!==d||e[5]!==p||e[6]!==y||e[7]!==w||e[8]!==E||e[9]!==S?(j=u.jsx("img",{className:E,src:w,alt:d,ref:p,style:S,onError:y,draggable:"false"}),e[4]=d,e[5]=p,e[6]=y,e[7]=w,e[8]=E,e[9]=S,e[10]=j):j=e[10],j}function et(){const r=le.c(1);let e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(e=u.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"}),r[0]=e):e=r[0],e}function ft(r){const e=le.c(78),{src:d,altText:L,nodeKey:p,width:w,height:x,maxWidth:h,resizable:b,showCaption:y,caption:E,captionsEnabled:S}=r,j=_.useRef(null),T=_.useRef(null),[f,m,i]=Le(p),[c,D]=_.useState(!1);qe();const[t]=$e(),[v,M]=_.useState(null),G=_.useRef(null),[$,o]=_.useState(!1),V=Re();let A;e[0]!==t||e[1]!==f?(A=z=>{const C=ae();return f&&oe(C)&&(z.preventDefault(),t.update(()=>{C.getNodes().forEach(rt)})),!1},e[0]=t,e[1]=f,e[2]=A):A=e[2];const P=A;let K;e[3]!==E||e[4]!==f||e[5]!==y?(K=z=>{const C=ae(),Y=T.current;if(f&&oe(C)&&C.getNodes().length===1){if(y)return be(null),z.preventDefault(),E.focus(),!0;if(Y!==null&&Y!==document.activeElement)return z.preventDefault(),Y.focus(),!0}return!1},e[3]=E,e[4]=f,e[5]=y,e[6]=K):K=e[6];const W=K;let O;e[7]!==E||e[8]!==t||e[9]!==m?(O=z=>G.current===E||T.current===z.target?(be(null),t.update(()=>{m(!0);const C=t.getRootElement();C!==null&&C.focus()}),!0):!1,e[7]=E,e[8]=t,e[9]=m,e[10]=O):O=e[10];const I=O;let B;e[11]!==i||e[12]!==c||e[13]!==f||e[14]!==m?(B=z=>{const C=z;return c?!0:C.target===j.current?(C.shiftKey?m(!f):(i(),m(!0)),!0):!1},e[11]=i,e[12]=c,e[13]=f,e[14]=m,e[15]=B):B=e[15];const k=B;let F;e[16]!==t?(F=z=>{t.getEditorState().read(()=>{const C=ae();z.target.tagName==="IMG"&&Pe(C)&&C.getNodes().length===1&&t.dispatchCommand(Ee,z)})},e[16]=t,e[17]=F):F=e[17];const s=F;let q;e[18]!==P||e[19]!==W||e[20]!==I||e[21]!==t||e[22]!==k||e[23]!==s?(q=()=>{let z=!0;const C=t.getRootElement(),Y=ke(t.registerUpdateListener(ne=>{const{editorState:ce}=ne;z&&M(ce.read(tt))}),t.registerCommand(Ke,(ne,ce)=>(G.current=ce,!1),Z),t.registerCommand(Ae,k,Z),t.registerCommand(Ee,k,Z),t.registerCommand(Te,ne=>ne.target===j.current?(ne.preventDefault(),!0):!1,Z),t.registerCommand(Xe,P,Z),t.registerCommand(He,P,Z),t.registerCommand(Ie,W,Z),t.registerCommand(We,I,Z));return C?.addEventListener("contextmenu",s),()=>{z=!1,Y(),C?.removeEventListener("contextmenu",s)}},e[18]=P,e[19]=W,e[20]=I,e[21]=t,e[22]=k,e[23]=s,e[24]=q):q=e[24];let N;e[25]!==P||e[26]!==W||e[27]!==I||e[28]!==i||e[29]!==t||e[30]!==c||e[31]!==f||e[32]!==p||e[33]!==k||e[34]!==s||e[35]!==m?(N=[i,t,c,f,p,P,W,I,k,s,m],e[25]=P,e[26]=W,e[27]=I,e[28]=i,e[29]=t,e[30]=c,e[31]=f,e[32]=p,e[33]=k,e[34]=s,e[35]=m,e[36]=N):N=e[36],_.useEffect(q,N);let a;e[37]!==t||e[38]!==p?(a=()=>{t.update(()=>{const z=we(p);fe(z)&&z.setShowCaption(!0)})},e[37]=t,e[38]=p,e[39]=a):a=e[39];const n=a;let U;e[40]!==t||e[41]!==p?(U=(z,C)=>{setTimeout(()=>{D(!1)},200),t.update(()=>{const Y=we(p);fe(Y)&&Y.setWidthAndHeight(z,C)})},e[40]=t,e[41]=p,e[42]=U):U=e[42];const H=U;let X;e[43]===Symbol.for("react.memo_cache_sentinel")?(X=()=>{D(!0)},e[43]=X):X=e[43];const R=X;let g;e[44]!==c||e[45]!==f||e[46]!==v?(g=f&&oe(v)&&!c,e[44]=c,e[45]=f,e[46]=v,e[47]=g):g=e[47];const J=g,Q=(f||c)&&V;let ee;e[48]!==L||e[49]!==x||e[50]!==Q||e[51]!==$||e[52]!==h||e[53]!==v||e[54]!==d||e[55]!==w?(ee=$?u.jsx(et,{}):u.jsx(Qe,{className:`max-w-full cursor-default ${Q?`${oe(v)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-2 ring-primary ring-offset-2`:null}`,src:d,altText:L,imageRef:j,width:w,height:x,maxWidth:h,onError:()=>o(!0)}),e[48]=L,e[49]=x,e[50]=Q,e[51]=$,e[52]=h,e[53]=v,e[54]=d,e[55]=w,e[56]=ee):ee=e[56];let te;e[57]!==J||e[58]!==ee?(te=u.jsx("div",{draggable:J,children:ee}),e[57]=J,e[58]=ee,e[59]=te):te=e[59];let re;e[60]!==E||e[61]!==y?(re=y&&u.jsx("div",{className:"image-caption-container absolute right-0 bottom-1 left-0 m-0 block min-w-[100px] overflow-hidden border-t bg-white/90 p-0",children:u.jsxs(Ve,{initialEditor:E,initialNodes:[Oe,Be,Ue],children:[u.jsx(ze,{}),u.jsx(Ce,{}),u.jsx(_e,{contentEditable:u.jsx(je,{className:"ImageNode__contentEditable user-select-text word-break-break-word relative block min-h-5 w-[calc(100%-20px)] cursor-text resize-none border-0 p-2.5 text-sm whitespace-pre-wrap caret-primary outline-none",placeholderClassName:"ImageNode__placeholder text-sm text-muted-foreground overflow-hidden absolute top-2.5 left-2.5 pointer-events-none text-ellipsis user-select-none whitespace-nowrap inline-block",placeholder:"Enter a caption..."}),ErrorBoundary:Se})]})}),e[60]=E,e[61]=y,e[62]=re):re=e[62];let se;e[63]!==S||e[64]!==t||e[65]!==Q||e[66]!==$||e[67]!==h||e[68]!==H||e[69]!==b||e[70]!==v||e[71]!==n||e[72]!==y?(se=b&&oe(v)&&Q&&u.jsx(Ze,{showCaption:y,setShowCaption:n,editor:t,buttonRef:T,imageRef:j,maxWidth:h,onResizeStart:R,onResizeEnd:H,captionsEnabled:!$&&S}),e[63]=S,e[64]=t,e[65]=Q,e[66]=$,e[67]=h,e[68]=H,e[69]=b,e[70]=v,e[71]=n,e[72]=y,e[73]=se):se=e[73];let ie;return e[74]!==te||e[75]!==re||e[76]!==se?(ie=u.jsx(_.Suspense,{fallback:null,children:u.jsxs(u.Fragment,{children:[te,re,se]})}),e[74]=te,e[75]=re,e[76]=se,e[77]=ie):ie=e[77],ie}function tt(){return ae()}function rt(r){fe(r)&&r.remove()}export{Ee as RIGHT_CLICK_IMAGE_COMMAND,ft as default};

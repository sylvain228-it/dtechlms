import{c as Xe,u as Je,r as ie,b as Ye,j as s,a as qe,H as Ze}from"./app-BzXwBPBx.js";import{I as Ae,T as Be,S as be,C as et}from"./form-B-fdkg48.js";import{T as Oe}from"./tags-input-B-TrG92r.js";import{B as Ie}from"./button-DpCkL2lj.js";import{L as He}from"./label-D5CJeCuB.js";import{S as $e}from"./spinner-CIZwnsdn.js";import{u as tt}from"./use-tmp-upload-H5QVf1fd.js";import{r as st,j as lt,l as it,k as rt}from"./type-DhUEUhhk.js";import{s as at,f as ot,u as ct,g as nt}from"./index-DWLCbCLc.js";import{C as pt}from"./index-BewVzqxI.js";import{b as dt}from"./index-BGGtLgwn.js";import ut from"./medias-layout-DH5ZOJ7k.js";import"./app-BlAWqAGg.js";import"./index-VdYImSg5.js";import"./index-BWbkfBfC.js";import"./index-CmvPZPYG.js";import"./index-BZwf-zK1.js";import"./index-CJlYDfk2.js";import"./index-B2cDW95s.js";import"./index-DAHL75PX.js";import"./index-BQPF0Rq9.js";import"./index-BucdvD4Q.js";import"./index-BRTuzqyl.js";import"./index-CoBc6tAl.js";import"./iconBase-BH9TG5R0.js";import"./index-D1DaFm8C.js";import"./index-CyaJm5Nq.js";import"./utils-e8IeQt0G.js";import"./createLucideIcon-BboBuA9R.js";import"./index-CMWG4mbA.js";import"./page-banner-CF78MDYO.js";import"./index-BqTge0le.js";import"./index-DF2umSuw.js";import"./arrow-left-AHTPeAno.js";function Gt(){const e=Xe.c(181),{media:a,entity_type:m,entity_id:g}=Je().props,{errors:r}=Je().props,o=!!a,[je,se]=ie.useState(""),ve=a?.title??"",Ne=a?.description??"",we=a?.resource_type??"",Fe=a?.storage_type??"local",Ce=a?.language??"fr",ke=a?.accessibility_level??"",Te=a?.pedagogical_role??"support",Re=o?a?.is_mandatory==1:!1,Se=o?a?.is_downloadable==1:!1;let f;e[0]!==o||e[1]!==a?(f=o&&a.learning_objectives!=null?JSON.parse(a?.learning_objectives):[],e[0]=o,e[1]=a,e[2]=f):f=e[2];let x;e[3]!==o||e[4]!==a?(x=o&&a.keywords!=null?JSON.parse(a?.keywords):[],e[3]=o,e[4]=a,e[5]=x):x=e[5];let h;e[6]!==o||e[7]!==a?(h=o&&a.tags!=null?JSON.parse(a?.tags):[],e[6]=o,e[7]=a,e[8]=h):h=e[8];const Ue=o?a.is_visible==1:!0;let re;e[9]!==ve||e[10]!==Ne||e[11]!==x||e[12]!==h||e[13]!==Ue||e[14]!==we||e[15]!==Fe||e[16]!==Ce||e[17]!==ke||e[18]!==Te||e[19]!==Re||e[20]!==Se||e[21]!==f?(re={title:ve,description:Ne,resource_type:we,storage_type:Fe,file:null,url:"",url_public_id:"",mime_type:"",file_ext:"",file_size:null,duration_minute:null,language:Ce,accessibility_level:ke,pedagogical_role:Te,is_mandatory:Re,is_downloadable:Se,learning_objectives:f,keywords:x,tags:h,author:"",source:"",license:"",access_instructions:"",is_visible:Ue,tmp_path:""},e[9]=ve,e[10]=Ne,e[11]=x,e[12]=h,e[13]=Ue,e[14]=we,e[15]=Fe,e[16]=Ce,e[17]=ke,e[18]=Te,e[19]=Re,e[20]=Se,e[21]=f,e[22]=re):re=e[22];const{data:t,setData:l,reset:_}=Ye(re);let ae;e[23]!==l?(ae={onUploadSuccess:i=>{l("tmp_path",i.path),l("mime_type",i.mime_type),l("file_size",i.file_size),l("file_ext",i.file_ext)},onRemoveSuccess:()=>l("tmp_path","")},e[23]=l,e[24]=ae):ae=e[24];const{file:n,tmpPath:oe,filePreview:p,uploadProgress:le,isRemoving:d,handleFileChange:Le,isUploading:y,remove:Ee}=tt(ae),[u,Pe]=ie.useState(!1),c=t.resource_type==="video"||t.resource_type==="audio"||t.resource_type==="document"||t.resource_type==="image",ce=c&&t.resource_type!=="document"&&t.resource_type!=="image";let ne,pe;e[25]!==p?(ne=()=>()=>{p&&URL.revokeObjectURL(p)},pe=[p],e[25]=p,e[26]=ne,e[27]=pe):(ne=e[26],pe=e[27]),ie.useEffect(ne,pe);let b;if(e[28]!==t||e[29]!==g||e[30]!==m||e[31]!==o||e[32]!==a?.id||e[33]!==_||e[34]!==n||e[35]!==l){let i=function(){Pe(!1),_("file","title","description","url","mime_type","file_size","tags","keywords")};b=async function(Ke){Ke.preventDefault(),Pe(!0),l("file_size",n?n.size:null),l("mime_type",n?n.type:"");const Qe=m&&g?at([m,g]).url:ot().url,We=m&&g?ct([a?.id??0,m,g]).url:nt(a?.id??0).url;o?await qe.post(We,t,{forceFormData:!0,onFinish:i}):await qe.post(Qe,t,{forceFormData:!0,onFinish:i})},e[28]=t,e[29]=g,e[30]=m,e[31]=o,e[32]=a?.id,e[33]=_,e[34]=n,e[35]=l,e[36]=b}else b=e[36];let de;e[37]===Symbol.for("react.memo_cache_sentinel")?(de=function(Me){e:switch(Me){case"video":{se("video/*");break e}case"audio":{se("audio/*");break e}case"image":{se("image/*");break e}case"document":{se(".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.odt");break e}default:se("")}},e[37]=de):de=e[37];const Ve=de;let ue,me;e[38]!==t.resource_type?(ue=()=>{Ve(t.resource_type)},me=[t.resource_type],e[38]=t.resource_type,e[39]=ue,e[40]=me):(ue=e[39],me=e[40]),ie.useEffect(ue,me);let ge,fe;e[41]!==l||e[42]!==oe?(ge=()=>l("tmp_path",oe),fe=[l,oe],e[41]=l,e[42]=oe,e[43]=ge,e[44]=fe):(ge=e[43],fe=e[44]),ie.useEffect(ge,fe);let xe;e[45]!==t.resource_type||e[46]!==t.title||e[47]!==t.tmp_path||e[48]!==t.url||e[49]!==o||e[50]!==d||e[51]!==c||e[52]!==y||e[53]!==u?(xe=t.title&&t.resource_type&&(c&&!o?t.tmp_path!=="":!0)&&!y&&!d&&!u&&(!c||t.url===""||/^https?:\/\//.test(t.url)),e[45]=t.resource_type,e[46]=t.title,e[47]=t.tmp_path,e[48]=t.url,e[49]=o,e[50]=d,e[51]=c,e[52]=y,e[53]=u,e[54]=xe):xe=e[54];const Ge=xe;console.log("errors",r);let he;e[55]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx(Ze,{title:"Upload médias"}),e[55]=he):he=e[55];let _e;e[56]===Symbol.for("react.memo_cache_sentinel")?(_e=s.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-800",children:"Uploader un média"}),e[56]=_e):_e=e[56];let j;e[57]!==l?(j=i=>l("title",i),e[57]=l,e[58]=j):j=e[58];let v;e[59]!==t.title||e[60]!==j?(v=s.jsx(Ae,{label:"Titre",value:t.title,onChange:j,placeholder:"Titre",required:!0}),e[59]=t.title,e[60]=j,e[61]=v):v=e[61];let N;e[62]!==r.title?(N=r.title&&s.jsx("p",{className:"mt-1 text-xs text-red-600",children:r.title}),e[62]=r.title,e[63]=N):N=e[63];let w;e[64]!==v||e[65]!==N?(w=s.jsxs("div",{children:[v,N]}),e[64]=v,e[65]=N,e[66]=w):w=e[66];let F;e[67]!==l?(F=i=>l("description",i),e[67]=l,e[68]=F):F=e[68];let C;e[69]!==t.description||e[70]!==F?(C=s.jsx(Be,{label:"Description",placeholder:"Description",value:t.description,onChange:F,rows:3}),e[69]=t.description,e[70]=F,e[71]=C):C=e[71];let k;e[72]!==r.description?(k=r.description&&s.jsx("p",{className:"mt-1 text-xs text-red-600",children:r.description}),e[72]=r.description,e[73]=k):k=e[73];let T;e[74]!==C||e[75]!==k?(T=s.jsxs("div",{children:[C,k]}),e[74]=C,e[75]=k,e[76]=T):T=e[76];let R;e[77]!==w||e[78]!==T?(R=s.jsxs("div",{className:"mb-4 grid gap-3",children:[w,T]}),e[77]=w,e[78]=T,e[79]=R):R=e[79];let S;e[80]!==l?(S=i=>l("resource_type",i),e[80]=l,e[81]=S):S=e[81];let U;e[82]!==t.resource_type||e[83]!==r.resource_type||e[84]!==S?(U=s.jsx(be,{label:"Type de ressource",value:t.resource_type,options:st,onChange:S,error:r.resource_type}),e[82]=t.resource_type,e[83]=r.resource_type,e[84]=S,e[85]=U):U=e[85];let L;e[86]!==je||e[87]!==t.resource_type||e[88]!==t.storage_type||e[89]!==t.tmp_path||e[90]!==r.file||e[91]!==r.storage_type||e[92]!==p||e[93]!==Le||e[94]!==d||e[95]!==c||e[96]!==y||e[97]!==Ee||e[98]!==n||e[99]!==l||e[100]!==le?(L=c&&s.jsxs(s.Fragment,{children:[s.jsx(be,{label:"Stockage",value:t.storage_type,options:lt,onChange:i=>l("storage_type",i),error:r.storage_type}),s.jsxs("div",{className:"col-span-2",children:[t.tmp_path==""&&!y&&s.jsxs("div",{children:[s.jsxs(He,{htmlFor:"uploadFile",className:"mt-2 flex cursor-pointer flex-col items-center justify-center rounded-lg border bg-gray-50 p-3 hover:bg-gray-100",children:[s.jsx(dt,{size:40}),s.jsx("div",{className:"mt-2 text-sm text-gray-600",children:n?n.name:"Aucun fichier sélectionné"})]}),s.jsx("input",{type:"file",id:"uploadFile",accept:je,disabled:t.tmp_path!=="",className:"hidden",onChange:i=>{Le(i),console.log("File selected:",i.target.files)}}),r.file&&s.jsx("p",{className:"mt-1 text-xs text-red-600",children:r.file})]}),p&&s.jsxs("div",{className:"mb-4",children:[s.jsx(He,{children:"Aperçu"}),s.jsx("div",{className:"mt-2 rounded border bg-muted p-2",children:t.resource_type==="video"?s.jsx("video",{src:p,controls:!0,className:"max-h-96 w-full rounded"}):t.resource_type==="audio"?s.jsx("audio",{src:p,controls:!0,className:"w-full"}):t.resource_type==="image"?s.jsx("img",{src:p,alt:"Aperçu du fichier",className:"max-h-96 w-full rounded object-contain"}):s.jsx("p",{className:"text-sm text-gray-600",children:"Aperçu non disponible pour ce type de fichier."})})]}),n&&s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700",children:n.name}),s.jsxs(Ie,{disabled:d||le!==100,type:"button",onClick:Ee,className:"cursor-pointer text-sm text-red-600 transition hover:text-red-700 hover:underline",children:[d&&s.jsx($e,{}),s.jsx(pt,{size:30})]})]}),s.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-200",children:s.jsx("div",{className:"bg-cblue h-full rounded-full transition-all duration-300",style:{width:`${le}%`}})}),s.jsxs("p",{className:"text-xs text-gray-500",children:[le,"% téléchargé"]})]})]})]}),e[86]=je,e[87]=t.resource_type,e[88]=t.storage_type,e[89]=t.tmp_path,e[90]=r.file,e[91]=r.storage_type,e[92]=p,e[93]=Le,e[94]=d,e[95]=c,e[96]=y,e[97]=Ee,e[98]=n,e[99]=l,e[100]=le,e[101]=L):L=e[101];let E;e[102]!==t.url||e[103]!==r.url||e[104]!==c||e[105]!==l?(E=!c&&s.jsx("div",{children:s.jsx(Ae,{label:"URL (optionnel)",value:t.url,onChange:i=>l("url",i),placeholder:"https://...",error:r.url})}),e[102]=t.url,e[103]=r.url,e[104]=c,e[105]=l,e[106]=E):E=e[106];let z;e[107]!==U||e[108]!==L||e[109]!==E?(z=s.jsxs("div",{className:"mb-4 grid gap-3 sm:grid-cols-2",children:[U,L,E]}),e[107]=U,e[108]=L,e[109]=E,e[110]=z):z=e[110];const ze=ce?"":"sm:col-span-2";let D;e[111]!==l?(D=i=>l("language",i),e[111]=l,e[112]=D):D=e[112];let A;e[113]!==t.language||e[114]!==r.language||e[115]!==D?(A=s.jsx(be,{label:"Langue",value:t.language,options:it,onChange:D,error:r.language}),e[113]=t.language,e[114]=r.language,e[115]=D,e[116]=A):A=e[116];let O;e[117]!==ze||e[118]!==A?(O=s.jsx("div",{className:ze,children:A}),e[117]=ze,e[118]=A,e[119]=O):O=e[119];let I;e[120]!==t.duration_minute||e[121]!==l||e[122]!==ce?(I=ce&&s.jsx("div",{children:s.jsx(Ae,{label:"Durée (minutes)",placeholder:'Durée en minutes, ex: "60" pour 1 heure',type:"number",value:t.duration_minute??"",onChange:i=>l("duration_minute",i?Number(i):null)})}),e[120]=t.duration_minute,e[121]=l,e[122]=ce,e[123]=I):I=e[123];let P;e[124]!==O||e[125]!==I?(P=s.jsxs("div",{className:"mb-4 grid gap-3 sm:grid-cols-2",children:[O,I]}),e[124]=O,e[125]=I,e[126]=P):P=e[126];let M;e[127]!==l?(M=i=>l("pedagogical_role",i),e[127]=l,e[128]=M):M=e[128];let J;e[129]!==t.pedagogical_role||e[130]!==r.pedagogical_role||e[131]!==M?(J=s.jsx(be,{label:"Rôle pédagogique",value:t.pedagogical_role,options:rt,onChange:M,error:r.pedagogical_role}),e[129]=t.pedagogical_role,e[130]=r.pedagogical_role,e[131]=M,e[132]=J):J=e[132];let q;e[133]!==l?(q=i=>l("learning_objectives",i),e[133]=l,e[134]=q):q=e[134];let B;e[135]!==t.learning_objectives||e[136]!==q?(B=s.jsx(Oe,{label:"Objectifs d'apprentissage",value:t.learning_objectives,onChange:q,placeholder:"Objectifs d'apprentissage"}),e[135]=t.learning_objectives,e[136]=q,e[137]=B):B=e[137];let H;e[138]!==l?(H=i=>l("keywords",i),e[138]=l,e[139]=H):H=e[139];let $;e[140]!==t.keywords||e[141]!==H?($=s.jsx(Oe,{label:"Mots-clés",value:t.keywords,onChange:H,placeholder:"Mots-clés"}),e[140]=t.keywords,e[141]=H,e[142]=$):$=e[142];let V;e[143]!==l?(V=i=>l("tags",i),e[143]=l,e[144]=V):V=e[144];let G;e[145]!==t.tags||e[146]!==V?(G=s.jsx(Oe,{label:"Tags",value:t.tags,onChange:V,placeholder:"Tags"}),e[145]=t.tags,e[146]=V,e[147]=G):G=e[147];let K;e[148]!==B||e[149]!==$||e[150]!==G?(K=s.jsxs("div",{className:"my-4 grid gap-2",children:[B,$,G]}),e[148]=B,e[149]=$,e[150]=G,e[151]=K):K=e[151];let Q;e[152]!==t.is_downloadable||e[153]!==c||e[154]!==l?(Q=c&&s.jsx("div",{className:"mb-4 grid gap-3 sm:grid-cols-3",children:s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(et,{label:"C'est téléchargeable",checked:t.is_downloadable,onChange:i=>l("is_downloadable",!!i)})})}),e[152]=t.is_downloadable,e[153]=c,e[154]=l,e[155]=Q):Q=e[155];let W;e[156]!==l?(W=i=>l("access_instructions",i),e[156]=l,e[157]=W):W=e[157];let X;e[158]!==t.access_instructions||e[159]!==W?(X=s.jsx("div",{className:"mb-4",children:s.jsx(Be,{label:"Instructions d'accès / Notes internes",placeholder:"Instructions d'accès / Notes internes",value:t.access_instructions,onChange:W,rows:3})}),e[158]=t.access_instructions,e[159]=W,e[160]=X):X=e[160];const De=u||!Ge;let Y;e[161]!==u?(Y=u&&s.jsx($e,{}),e[161]=u,e[162]=Y):Y=e[162];let Z;e[163]!==De||e[164]!==Y?(Z=s.jsxs(Ie,{type:"submit",className:"btn-primary",disabled:De,children:[Y," Enregistrer"]}),e[163]=De,e[164]=Y,e[165]=Z):Z=e[165];let ee;e[166]!==_?(ee=s.jsx(Ie,{variant:"ghost",type:"button",onClick:()=>{_("file","title","description","url","mime_type","file_size","tags","keywords")},children:"Réinitialiser"}),e[166]=_,e[167]=ee):ee=e[167];let te;e[168]!==Z||e[169]!==ee?(te=s.jsxs("div",{className:"flex items-center gap-2",children:[Z,ee]}),e[168]=Z,e[169]=ee,e[170]=te):te=e[170];let ye;return e[171]!==b||e[172]!==R||e[173]!==z||e[174]!==P||e[175]!==J||e[176]!==K||e[177]!==Q||e[178]!==X||e[179]!==te?(ye=s.jsxs(ut,{title:"Upload médias",children:[he,s.jsx("div",{className:"mx-auto mt-8 max-w-3xl",children:s.jsxs("form",{onSubmit:b,className:"rounded-lg border bg-white p-6 shadow",encType:"multipart/form-data",children:[_e,R,z,P,J,K,Q,X,te]})})]}),e[171]=b,e[172]=R,e[173]=z,e[174]=P,e[175]=J,e[176]=K,e[177]=Q,e[178]=X,e[179]=te,e[180]=ye):ye=e[180],ye}export{Gt as default};

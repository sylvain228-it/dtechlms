import{u as E,b as z,r as o,R as I,j as a,a as D}from"./app-BOmU1wmL.js";import{I as r,T as W,S as n,C as l}from"./form-Cdl3Pe45.js";import{S}from"./spinner--AHlGxP7.js";import{o as M,z as P,u as O,D as U,E as V,F as $,G as Y}from"./type-DDACwUq3.js";import{B as F}from"./button-BXeYMGgI.js";import{T as J}from"./teacher-layouts-Ur2cbxUY.js";import{a as K}from"./tasks-WJQL2uDA.js";import{g as Q}from"./index-BhKAPyE2.js";import{u as X,a as Z}from"./index-CU8SWGOj.js";import ee from"./text-editor-BRyy4XKm.js";import"./app-VvtKnDwK.js";import"./utils-e8IeQt0G.js";import"./createLucideIcon-DUOuwx2-.js";import"./index-sq8JxwLA.js";import"./index-CtUadT9n.js";import"./index-CyaJm5Nq.js";import"./page-banner-C7OHPqMr.js";import"./index-BqTge0le.js";import"./index-CMWG4mbA.js";import"./index-fxZgv_cA.js";import"./iconBase-CPalTnLO.js";import"./arrow-left-CgAHiiqU.js";import"./app-logo-icon-CK9aNDB_.js";import"./user-profile-trigger-BYgeGczA.js";import"./sun-B3Xv17I3.js";import"./avatar-CufrlqXh.js";import"./index-DdNxHDY2.js";import"./index-BdIQ-kbR.js";import"./index-C6gdkV91.js";import"./avatar-fallback-BjXZxSaF.js";import"./use-initials-GDEZD6-s.js";import"./divider-BBgeuDb2.js";import"./profile-svg-Bwy5UQEi.js";import"./dropdown-menu-DRIWHMxB.js";import"./index-BwiOEFi6.js";import"./index-XA1OJB6Q.js";import"./index-B-fAkSq4.js";import"./index-DTrOkFw6.js";import"./index-1aSE4XS9.js";import"./index-CXwkwjvO.js";import"./check-D2RIYBP2.js";import"./logout-user-HcNmiAIC.js";import"./index-wHDUIrgA.js";import"./index-v3lNCs8j.js";import"./index-DGvaH1zc.js";import"./log-out-BmohMvgA.js";import"./index-8GFiKN7D.js";import"./index-DMEIf3eg.js";import"./index-B5Wz6g3U.js";import"./index-088ta_6r.js";import"./index-D-fKvoRm.js";import"./index-oCkK5fXa.js";import"./index-CKQT5-Tp.js";import"./gauge-04CtoFE8.js";import"./calendar-B0CvDZ_G.js";import"./settings-Ch-IO4g_.js";import"./x-Cxqud0xV.js";import"./menu-VI9xwiLb.js";import"./lexical-headless-CJI_HsZI.js";import"./nodes-CImg-T9u.js";import"./index-DH9SVvWg.js";import"./index-CJeVcETn.js";import"./index-BD3HuK-g.js";import"./index-C4OL-TuX.js";import"./index-Bwrcs2qz.js";import"./index-DerrCcFj.js";import"./index-D_EaEfK3.js";import"./editor-CO3KJCTx.js";import"./tooltip-B-9YRlG5.js";import"./index-Bs-2WC09.js";import"./content-editable-zq9nIIPc.js";import"./dialog-4kNTCLrK.js";import"./index-CTyL-A3x.js";import"./command-0ugShPvD.js";import"./search-CS9TKoj2.js";import"./input-BasXNOLM.js";import"./label-dU9c1Gas.js";import"./popover-CW35KCFR.js";import"./trash-ZyzuEw0V.js";import"./separator-C2_OsKSl.js";import"./index-CaVr11ya.js";import"./index-CBdR2yVO.js";import"./chevron-up-CD7H7HTg.js";import"./chevron-down-Cr3D6SAa.js";import"./list-DNO3BUta.js";import"./image-BFEHe2fM.js";const ie={lecture:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},discussion:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!0,allowGroupWork:!0},quiz:{canBeEvaluated:!0,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},exercise:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},project:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},assessment:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0}};function Bi(){const{course:u,activity:s,c_modality:j}=E().props,{errors:p}=E().props;console.log("error",p);const c=!!s,{data:e,setData:t}=z({parent_course_id:u.id,course_id:s?.course_id??"",module_id:s?.module_id??"",sequence_id:s?.sequence_id??"",title:s?.title??"",description:s?.description??"",activity_type:s?.activity_type??"",order:s?.order??"",estimated_minutes:s?.estimated_minutes??null,scope:s?.scope??"",modality:s?.modality??u.modality,is_individual:!!s?.is_individual,is_collaborative:!!s?.is_collaborative,max_group_size:s?.max_group_size??null,has_deliverable:!!s?.has_deliverable,deliverable_type:s?.deliverable_type??"",deliverable_deadline:s?.deliverable_deadline??null,is_evaluated:!!s?.is_evaluated,evaluation_type:s?.evaluation_type??"",evaluation_weight:s?.evaluation_weight??null,note_unit:s?.note_unit??"",resources_summary:s?.resources_summary??"",requires_feedback:!!s?.requires_feedback,allows_resubmission:!!s?.allows_resubmission,max_attempts:s?.max_attempts??null,is_synchronous:!!s?.is_synchronous,start_at:s?.start_at?new Date(s.start_at).toISOString().slice(0,16):null,duration_minutes:s?.duration_minutes??null,conference_platform:s?.conference_platform??"",conference_url:s?.conference_url??"",conference_meeting_id:s?.conference_meeting_id??"",conference_passcode:s?.conference_passcode??"",attendance_required:s?.attendance_required,is_mandatory:s?.is_mandatory,is_visible:s?.is_visible??!0}),[v,h]=o.useState(!1),d=o.useMemo(()=>e.activity_type?ie[e.activity_type]:null,[e.activity_type]);o.useEffect(()=>{!d?.canBeEvaluated&&e.is_evaluated&&(t("is_evaluated",!1),t("evaluation_type",""),t("evaluation_weight",null))},[e.is_evaluated,d?.canBeEvaluated,t]),o.useEffect(()=>{e.activity_type=="assessment"&&t("is_evaluated",!0)},[e.is_evaluated,e.activity_type,t]),o.useEffect(()=>{!d?.canHaveDeliverable&&e.has_deliverable&&(t("has_deliverable",!1),t("deliverable_type",""),t("deliverable_deadline",null))},[e.has_deliverable,d?.canHaveDeliverable,t]),o.useEffect(()=>{e.is_collaborative&&t("is_individual",!1),e.is_individual&&(t("is_collaborative",!1),t("max_group_size",null))},[e.is_collaborative,e.is_individual,t]),o.useEffect(()=>{e.attendance_required&&t("is_mandatory",!0)},[e.attendance_required,t]),o.useEffect(()=>{e.activity_type=="discussion"&&(t("is_individual",!1),t("is_collaborative",!0))},[e.activity_type,t]);const T=e.is_collaborative,R=e.is_evaluated,B=e.allows_resubmission,L=e.modality=="online"||e.modality=="hybrid",[G,q]=I.useState(!1),[N,y]=o.useState([]),[C,f]=o.useState([]);async function A(i){if(y([]),f([]),t("module_id",""),t("sequence_id",""),i=="course"){t("course_id",u.id);return}t("course_id","");try{q(!0);const m=await(await fetch(`${Q(u.slug).url}?scope=${i.toLowerCase()}`,{method:"GET"})).json();if(console.log("result",m),q(!1),m.status==200){const b=[];for(const x of m.data)b.push({key:x.id,value:x.title??x.name});console.log("daaa",b),i=="module"?(y(b),f([])):i=="sequence"&&(f(b),y([]))}else console.error("Donnée non trouvé"),console.error("result.message",m.message)}catch(_){console.error("Erreur",_)}}const k=i=>{i.preventDefault(),h(!0);async function _(){await K(c?s?.id:0).then(()=>{const m={...e,_method:c?"put":"post"};t("is_synchronous",g),c&&s?D.put(X([u.slug,s.id]),m,{onFinish:()=>h(!1)}):D.post(Z(u.slug),m,{onFinish:()=>h(!1)})})}_()};function H(i){i.preventDefault(),k(i)}const g=e.modality&&e.modality!="asynchronous",w=!!(e.title&&e.activity_type&&e.modality&&(!g||e.start_at&&e.duration_minutes)&&(!e.is_evaluated||e.evaluation_type)&&(!e.has_deliverable||e.deliverable_type));return a.jsx(J,{title:c?"Modifier activité":"Nouvelle activité",children:a.jsxs("div",{className:"mx-auto mt-8 max-w-4xl",children:[a.jsxs("div",{className:"mb-5 flex items-center justify-between border-b p-3",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold",children:c?"Modifier l'activité":"Nouvelle activité"}),a.jsxs(F,{className:"btn-primary",disabled:v||!w,onClick:H,children:[v&&a.jsx(S,{}),"Enregistrer"]})]}),a.jsxs("form",{onSubmit:k,className:"rounded-lg border bg-white p-3 shadow sm:p-6",children:[a.jsx("div",{className:"mb-2",children:a.jsx(r,{label:"Ordre",type:"number",required:!0,value:e.order??"",onChange:i=>t("order",Number(i))})}),a.jsx("div",{className:"mb-2",children:a.jsx(r,{label:"Titre",value:e.title,onChange:i=>t("title",i),error:p.title,required:!0})}),a.jsx("div",{className:"mb-2",children:a.jsx(W,{label:"Description",rows:3,value:e.description,onChange:i=>t("description",i),error:p.description})}),a.jsx("div",{className:"mb-4",children:a.jsx(n,{label:"Type d'activité",value:e.activity_type,onChange:i=>t("activity_type",i),options:M,required:!0})}),a.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-6 sm:grid-cols-2",children:[a.jsx(n,{label:"Portée",value:e.scope,disabled:G,onChange:i=>{t("scope",i),i!=e.scope&&A(i)},options:P,required:!0}),j!="asynchronous"&&a.jsx(n,{label:"Mode de déroulement",value:e.modality,onChange:i=>t("modality",i),options:O,required:!0})," "]}),N.length>0&&a.jsx("div",{className:"my-4",children:a.jsx(n,{label:"Liste des modules",emptyOption:"Sélectionner un module",value:e.module_id.toString(),onChange:i=>t("module_id",Number(i)),options:N,required:!0})}),C.length>0&&a.jsx("div",{className:"my-4",children:a.jsx(n,{label:"Liste des séquences",emptyOption:"Sélectionner une séquence",value:e.sequence_id.toString(),onChange:i=>t("sequence_id",Number(i)),options:C,required:!0})}),e.course_id!=""&&e.scope=="course"&&a.jsx("div",{className:"text-md my-4 block rounded-sm border bg-gray-100/50 p-2 font-bold text-gray-600 sm:text-xl",children:u.title}),d?.canBeEvaluated&&a.jsx(l,{label:"Activité évaluée",checked:e.is_evaluated,onChange:i=>{e.activity_type!="assessment"&&t("is_evaluated",i)}}),e.is_evaluated&&a.jsx("div",{className:"my-6 rounded border bg-gray-50 p-4",children:R&&a.jsxs("div",{className:"mt-2 grid gap-2",children:[a.jsx(n,{label:"Type d'évaluation",value:e.evaluation_type,onChange:i=>t("evaluation_type",i),options:U}),a.jsx(n,{label:"Unité de notation",value:e.note_unit??"fr",onChange:i=>t("note_unit",i),options:V,required:!0,error:p.note_unit}),a.jsx(r,{label:`Poids (${e.note_unit})`,type:"number",value:e.evaluation_weight??"",onChange:i=>t("evaluation_weight",i?Number(i):null)})]})}),d?.canHaveDeliverable&&a.jsx(l,{label:"Soumission requise",checked:e.has_deliverable,onChange:i=>t("has_deliverable",i)}),e.has_deliverable&&a.jsxs("div",{className:"my-6",children:[a.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[a.jsx(n,{label:"Type de soumission",value:e.deliverable_type,onChange:i=>t("deliverable_type",i),options:$,required:!0}),a.jsx(r,{label:"Date limite",type:"datetime-local",value:e.deliverable_deadline??"",onChange:i=>t("deliverable_deadline",i)})]}),a.jsxs("div",{className:"mt-4 flex gap-3",children:[a.jsx(l,{label:"Re soumission",checked:e.allows_resubmission,onChange:i=>t("allows_resubmission",i)}),B&&a.jsx(r,{label:"Nombre maximum",type:"number",value:e.max_attempts??"",onChange:i=>t("max_attempts",i?Number(i):null)})]})]}),d?.allowGroupWork&&e.activity_type!="discussion"&&a.jsx("div",{children:a.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[a.jsxs("div",{className:"flex gap-4",children:[!e.is_collaborative&&a.jsx(l,{label:"Individuel",checked:e.is_individual,onChange:i=>t("is_individual",i)}),!e.is_individual&&a.jsx(l,{label:"Collaboratif",checked:e.is_collaborative,onChange:i=>t("is_collaborative",i)})]}),T&&a.jsx(r,{label:"Taille max du groupe",type:"number",value:e.max_group_size??"",onChange:i=>t("max_group_size",i?Number(i):null)})]})}),j!="asynchronous"&&e.modality&&e.modality!="asynchronous"&&a.jsxs("div",{className:"mt-6",children:[a.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:[a.jsx(r,{label:"Début",required:!0,type:"datetime-local",value:e.start_at??"",onChange:i=>t("start_at",i)}),a.jsx(r,{label:"Durée (min)",type:"number",required:!0,value:e.duration_minutes??"",onChange:i=>t("duration_minutes",i?Number(i):null)})]}),L&&a.jsx("div",{children:a.jsxs("div",{className:"mt-6 grid gap-2 rounded border bg-gray-50 p-4",children:[a.jsx("h3",{className:"mb-3 font-semibold",children:"Visioconférence"}),a.jsx(n,{label:"Plateforme",value:e.conference_platform,onChange:i=>t("conference_platform",i),options:Y,required:!0}),a.jsx(r,{label:"URL",required:!0,value:e.conference_url,onChange:i=>t("conference_url",i)}),a.jsx(r,{label:"Meeting ID",value:e.conference_meeting_id,onChange:i=>t("conference_meeting_id",i)}),a.jsx(r,{label:"Code",value:e.conference_passcode,onChange:i=>t("conference_passcode",i)})]})})]}),a.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.modality!="asynchronous"&&a.jsx(l,{label:"Présence obligatoire",checked:e.attendance_required,onChange:i=>t("attendance_required",i)}),e.modality=="asynchronous"&&a.jsx(l,{label:"Est Obligatoire",checked:e.is_mandatory,onChange:i=>t("is_mandatory",i)}),a.jsx(l,{label:"Activité en temps réel",checked:g,onChange:()=>null})]}),a.jsxs("div",{className:"my-6 grid gap-3 sm:grid-cols-2",children:[d?.canRequestFeedback&&a.jsxs("div",{className:"my-3",children:[" ",a.jsx(l,{label:"Feedback enseignant requis.",checked:e.requires_feedback,onChange:i=>t("requires_feedback",i)})]}),a.jsx(l,{label:"Visible",checked:e.is_visible==!0,onChange:i=>t("is_visible",i)})]}),a.jsxs("div",{className:"my-6",children:[a.jsx("h3",{className:"mb-3 text-2xl font-semibold",children:"Ressources pédagogiques"}),a.jsx(ee,{isNew:!c}),a.jsx("p",{className:"text-xs text-red-500",children:p.resources_summary})]}),a.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t pt-4",children:[a.jsx("button",{type:"button",onClick:()=>history.back(),className:"rounded border px-4 py-2",children:"Annuler"}),a.jsxs(F,{type:"submit",className:"btn-primary",disabled:v||!w,children:[v&&a.jsx(S,{}),c?"Enregistrer":"Ajouter l'activité"]})]})]})]})})}export{Bi as default};

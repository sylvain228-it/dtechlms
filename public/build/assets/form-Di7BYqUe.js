import{c as I,j as e,u as A,r as j,b as K,e as V,a as Q}from"./app-BzXwBPBx.js";import{I as W,T as X}from"./form-B-fdkg48.js";import{U as Y}from"./upload-list-shared-D3_j6EXi.js";import{c as ee}from"./index-CyaJm5Nq.js";import{c as E,d as S}from"./utils-e8IeQt0G.js";import{B as C}from"./button-DpCkL2lj.js";import{L as te}from"./label-D5CJeCuB.js";import{S as $}from"./spinner-CIZwnsdn.js";import{T as se}from"./student-layouts-t6pggq_i.js";import{c as re,i as ae}from"./type-DhUEUhhk.js";import{b as ie}from"./index-CQybyuYf.js";import{C as le}from"./index-BewVzqxI.js";import{C as z}from"./circle-alert-BO1etdrS.js";import{C as de}from"./clock-BtWjw7tR.js";import{I as oe}from"./info-CFqzZOop.js";import{C as ne}from"./circle-check-big-EYTKQ_CH.js";import{c as B}from"./createLucideIcon-BboBuA9R.js";import"./app-BlAWqAGg.js";import"./download-DP38PM1j.js";import"./index-D1DaFm8C.js";import"./index-CmvPZPYG.js";import"./index-BZwf-zK1.js";import"./page-banner-CF78MDYO.js";import"./index-BqTge0le.js";import"./index-CMWG4mbA.js";import"./index-DF2umSuw.js";import"./iconBase-BH9TG5R0.js";import"./arrow-left-AHTPeAno.js";import"./app-logo-icon-C2LaG9_Q.js";import"./divider-B09NDvil.js";import"./profile-svg-DwoHoZ6q.js";import"./user-profile-trigger-Dk_TTr5J.js";import"./sun-D7S3RfEj.js";import"./avatar-BR3sBMG9.js";import"./index-BWbkfBfC.js";import"./index-B2cDW95s.js";import"./avatar-fallback-D5NPW7a4.js";import"./use-initials-GDEZD6-s.js";import"./dropdown-menu-DlZS67It.js";import"./index-VdYImSg5.js";import"./index-CJlYDfk2.js";import"./index-DAHL75PX.js";import"./index-BQPF0Rq9.js";import"./index-BucdvD4Q.js";import"./index-BRTuzqyl.js";import"./check-BHZKRPmL.js";import"./logout-user-Ce_sIJue.js";import"./index-wHDUIrgA.js";import"./index-v3lNCs8j.js";import"./index-DGvaH1zc.js";import"./log-out-BkvcRscv.js";import"./index-Vl0f8Y-f.js";import"./index-DMEIf3eg.js";import"./index-BemDBUNW.js";import"./index-B_X-8rh8.js";import"./nav-items-Ccw_83S7.js";import"./index-BGGtLgwn.js";import"./settings-NUZ-cO65.js";import"./gauge-Cjf8cet3.js";import"./book-Br9QRIqO.js";import"./calendar-BjFjFj4e.js";import"./book-open-DAOtQgtK.js";import"./x-BWOBLZ9u.js";import"./menu-CWhsNS-k.js";const me=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],ce=B("FileUp",me);const pe=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],xe=B("Loader",pe),ue=ee("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function g(n){const s=I.c(10);let t,r,d;s[0]!==n?({className:t,variant:d,...r}=n,s[0]=n,s[1]=t,s[2]=r,s[3]=d):(t=s[1],r=s[2],d=s[3]);let o;s[4]!==t||s[5]!==d?(o=E(ue({variant:d}),t),s[4]=t,s[5]=d,s[6]=o):o=s[6];let u;return s[7]!==r||s[8]!==o?(u=e.jsx("div",{"data-slot":"alert",role:"alert",className:o,...r}),s[7]=r,s[8]=o,s[9]=u):u=s[9],u}function h(n){const s=I.c(8);let t,r;s[0]!==n?({className:t,...r}=n,s[0]=n,s[1]=t,s[2]=r):(t=s[1],r=s[2]);let d;s[3]!==t?(d=E("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),s[3]=t,s[4]=d):d=s[4];let o;return s[5]!==r||s[6]!==d?(o=e.jsx("div",{"data-slot":"alert-description",className:d,...r}),s[5]=r,s[6]=d,s[7]=o):o=s[7],o}function Ft(){const{errors:n}=A().props,{submissionUploads:s,activity:t,submission:r,isResubmission:d}=A().props,[o,u]=j.useState(0),[P,D]=j.useState(!1),[O,R]=j.useState(!1),_=t.deliv_requirements,[k,N]=j.useState(!1),{data:l,setData:p}=K({activity_id:t.id,title:r?.title??"",description:r?.description??"",submitted_files:r?.submitted_files??"",uploadSelectedFile:[]}),b=t.deliverable_deadline?new Date(t.deliverable_deadline):null,w=new Date,F=b&&w>b,H=b&&w<b&&b.getTime()-w.getTime()<1440*60*1e3;console.log("upload:::",l.uploadSelectedFile);async function J(a,i){a.preventDefault();const m=a.target.files?.[0]??null,c=l.uploadSelectedFile.find(f=>f.requirement_id===i);if(c!==void 0&&U(c),m){D(!0);const f=URL.createObjectURL(m),y=new FormData;y.append("file",m);try{const x={file:m,preview:f,requirement_id:i,upload_progress:o,isUploading:!0},v=await(await V.post("/upload-to-tmp",y,{onUploadProgress:T=>{const M=Math.round(T.loaded*100/(T.total||1));u(M),x.upload_progress=M,p("uploadSelectedFile",[...l.uploadSelectedFile,x])}})).data;p("uploadSelectedFile",[...l.uploadSelectedFile,{...x,tmp_path:v.path,mime_type:v.mime_type,file_ext:v.file_ext,file_size:v.file_size,isUploading:!1}])}catch(x){throw console.log("error upload ",x),x}finally{D(!1)}}}async function U(a){if(a.tmp_path){a.isRemoving=!0,p("uploadSelectedFile",[...l.uploadSelectedFile,a]),R(!0);try{const i=new FormData;i.append("tmp_path",a.tmp_path),await V.post("/remove-from-tmp",i),a.preview=null,a.upload_progress=0,a.isRemoving=!1,p("uploadSelectedFile",[...l.uploadSelectedFile,a])}catch(i){throw console.log("error upload ",a.requirement_id,i),i}finally{a.isRemoving=!1,p("uploadSelectedFile",[...l.uploadSelectedFile,a]),p("uploadSelectedFile",l.uploadSelectedFile.filter(i=>i.requirement_id!==a.requirement_id)),R(!1)}}}const Z=a=>{a.preventDefault(),N(!0);const i=new FormData;i.append("title",l.title),i.append("description",l.description),i.append("activity_id",l.activity_id.toString());const m=[];l.uploadSelectedFile.forEach(c=>{const f=_?.find(x=>x.id==c.requirement_id)?.title,y={tmp_path:c.tmp_path,mime_type:c.mime_type,file_ext:c.file_ext,file_size:c.file_size,requirement_id:c.requirement_id,title:f};m.push(y)}),i.append("uploaded_list",JSON.stringify(m)),Q.post(ie(t.id),i,{onSuccess:()=>{N(!1)},onError:()=>{N(!1)}})};function q(a){switch(a){case"video":return"video/*";case"audio":return"audio/*";case"image":return"image/*";default:return""}}const G=l.title&&l.uploadSelectedFile.length>0&&!P&&!O&&!k;console.log("errors ",n);const L=!!(r&&r.status!=="graded"&&t.allow_resubmission&&t.deliverable_deadline&&new Date(t.deliverable_deadline)>new Date&&t.max_attempts&&r.nb_attempt<t.max_attempts);return e.jsx(se,{title:"Formulaire de soumission d'activité",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"mb-2 text-3xl font-bold text-gray-900 dark:text-white",children:t.title}),t.description&&e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:t.description})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[F&&!t.allow_late_submission&&e.jsxs(g,{className:"border-red-200 bg-red-50 dark:border-red-900 dark:bg-red-950",children:[e.jsx(z,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),e.jsx(h,{className:"text-red-800 dark:text-red-200",children:"La date limite de soumission est dépassée. Les soumissions ne sont plus acceptées pour cette activité."})]}),F&&t.allow_late_submission&&e.jsxs(g,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-900 dark:bg-yellow-950",children:[e.jsx(z,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),e.jsxs(h,{className:"text-yellow-800 dark:text-yellow-200",children:["Vous soumettez après la date limite.",t.late_penalty_percentage&&e.jsxs("span",{children:[" ","Une pénalité de"," ",t.late_penalty_percentage,"% sera appliquée."]})]})]}),H&&!F&&e.jsxs(g,{className:"border-orange-200 bg-orange-50 dark:border-orange-900 dark:bg-orange-950",children:[e.jsx(de,{className:"h-4 w-4 text-orange-600 dark:text-orange-400"}),e.jsxs(h,{className:"text-orange-800 dark:text-orange-200",children:["La date limite est très proche :"," ",S(t.deliverable_deadline??"")]})]}),r&&d&&e.jsxs("div",{className:"border-b pb-5",children:[L&&e.jsxs(g,{className:"border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950",children:[e.jsx(oe,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsxs(h,{className:"text-blue-800 dark:text-blue-200",children:["Vous re-soumettez cette activité. Votre version précédente sera remplacée.",t.max_attempts&&r.nb_attempt>=1&&e.jsxs("span",{children:["Tentatives restantes :"," ",e.jsx("b",{children:t.max_attempts-r.nb_attempt})," ","sur"," ",e.jsx("b",{children:t.max_attempts})]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Dernière soumission :"," ",S(r.created_at??"")," ","- Statut :"," ",e.jsx("span",{className:`font-medium ${r.status==="graded"?"text-green-600 dark:text-green-400":r.status==="submitted"?"text-yellow-600 dark:text-yellow-400":"text-gray-600 dark:text-gray-400"}`,children:r.status==="graded"?"Évaluée":r.status==="submitted"?"En attente d'évaluation":"Non soumise"})," "]}),s&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h4",{className:"mt-4 mb-3 text-sm font-medium text-gray-900 dark:text-white",children:["Fichiers soumis :"," "]}),e.jsx(Y,{submissionUploads:s})]})]})]}),r&&r.status==="graded"&&e.jsxs(g,{className:"border-green-200 bg-green-50 dark:border-green-900 dark:bg-green-950",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsxs(h,{className:"text-green-800 dark:text-green-200",children:["Cette activité a déjà été évaluée.",t.allow_resubmission?e.jsxs("span",{children:[" ","Vous pouvez la re-soumettre pour amélioration."]}):e.jsxs("span",{children:[" ","Aucune re-soumission n'est possible."]})]})]})]}),e.jsx("div",{className:"mb-8 grid gap-4 rounded-lg border border-gray-200 bg-gray-50 p-6 dark:border-gray-700 dark:bg-gray-900",children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:[t.deliverable_deadline&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date limite"}),e.jsx("p",{className:"mt-1 text-base font-semibold text-gray-900 dark:text-white",children:S(t.deliverable_deadline??"")})]}),t.is_evaluated&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Note maximale"}),e.jsxs("p",{className:"mt-1 text-base font-semibold text-gray-900 dark:text-white",children:[t.evaluation_max_weight," ",t.note_unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Moyènne"}),e.jsxs("p",{className:"mt-1 text-base font-semibold text-gray-900 dark:text-white",children:[t.evaluation_weight," ",t.note_unit]})]})]}),t.is_collaborative&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Type de travail"}),e.jsxs("p",{className:"mt-1 text-base font-semibold text-gray-900 dark:text-white",children:["Collaboratif",t.max_group_size&&e.jsxs("span",{children:[" ","(Max ",t.max_group_size,")"]})]})]}),t.is_individual&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Type de travail"}),e.jsx("p",{className:"mt-1 text-base font-semibold text-gray-900 dark:text-white",children:"Individuel"})]}),r&&r.score!==null&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Note actuelle"}),e.jsxs("p",{className:"mt-1 text-base font-semibold text-green-600 dark:text-green-400",children:[r.score," /"," ",t.evaluation_max_weight," ",t.note_unit]})]})]})}),L&&e.jsx("form",{onSubmit:Z,children:e.jsxs("div",{className:"space-y-6 rounded-lg border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800",children:[e.jsx("div",{children:e.jsx(W,{label:"Titre de la soumission",type:"text",value:l.title,onChange:a=>p("title",a),error:n.title,placeholder:"Donnez un titre à votre soumission (optionnel)"})}),e.jsx("div",{children:e.jsx(X,{label:"Description / Commentaires",value:l.description,onChange:a=>p("description",a),placeholder:"Décrivez votre soumission, ajoutez des commentaires ou des explications...",rows:4,error:n.description})}),t.has_deliverable&&_&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Fichiers à soumettre",e.jsx("span",{className:"text-red-600",children:"*"})]}),_.map(a=>{const i=l.uploadSelectedFile.find(m=>m.requirement_id===a.id);return e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-md mb-3 font-medium text-gray-900 dark:text-white",children:a.title}),!i&&e.jsxs("label",{htmlFor:`file-upload-${a.id}`,className:"flex cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-gray-300 px-6 py-10 transition-colors hover:border-blue-500 hover:bg-blue-50 dark:border-gray-600 dark:hover:bg-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"mx-auto h-10 w-10 text-gray-400 dark:text-gray-500"}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Cliquez ou glissez-déposez le fichier ici"}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[a.file_type=="file"?re(a.allowed_file_type):ae(a.file_type)," ","jusqu'à"," ",a.max_size_mb,"MB"]})]}),e.jsx("input",{id:`file-upload-${a.id}`,type:"file",accept:a.file_type==="file"?`.${a.allowed_file_type}`:q(a.allowed_file_type??""),onChange:m=>{J(m,a.id),console.log("iiiddd:",a.id)},className:"hidden"})]}),i?.isUploading&&e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-blue-300 bg-blue-50 px-6 py-10 text-center dark:border-blue-700 dark:bg-blue-900",children:[e.jsx($,{}),e.jsx("p",{className:"mt-2 text-sm text-blue-600 dark:text-blue-300",children:"Téléchargement en cours..."})]}),i!==void 0&&i.preview!==null&&e.jsxs("div",{className:"mb-4",children:[e.jsx(te,{children:"Aperçu"}),e.jsx("div",{className:"mt-2 rounded border bg-muted p-2",children:a.file_type==="video"?e.jsx("video",{src:i.preview,controls:!0,className:"max-h-96 w-full rounded"}):a.file_type==="audio"?e.jsx("audio",{src:i.preview,controls:!0,className:"w-full"}):a.file_type==="image"?e.jsx("img",{src:i.preview,alt:"Aperçu du fichier",className:"max-h-96 w-full rounded object-contain"}):e.jsx("p",{className:"text-sm text-gray-600",children:"Aperçu non disponible pour ce type de fichier."})})]}),i&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:i.file?.name}),i&&i.tmp_path!==null&&e.jsxs(C,{disabled:i.isRemoving||o!==100,type:"button",onClick:()=>{U(i)},className:"cursor-pointer text-sm text-red-600 transition hover:text-red-700 hover:underline",children:[i.isRemoving&&e.jsx($,{}),e.jsx(le,{size:30})]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:"h-full rounded-full bg-cblue transition-all duration-300",style:{width:`${i.upload_progress}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500",children:[i.upload_progress,"% téléchargé"]})]})]},a.id)})]}),e.jsxs("div",{className:"flex gap-3 border-t border-gray-200 pt-6 dark:border-gray-700",children:[e.jsxs(C,{type:"submit",disabled:k||t.has_deliverable===1&&l.uploadSelectedFile.length===0||!G,className:"flex items-center gap-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:[k&&e.jsx(xe,{className:"h-4 w-4 animate-spin"}),r&&d?"Re-soumettre":"Soumettre"]}),e.jsx(C,{type:"button",onClick:()=>window.history.back(),className:"border border-gray-300 bg-white text-gray-900 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Annuler"})]})]})}),r&&r.status==="graded"&&!t.allow_resubmission&&e.jsxs(g,{className:"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-900",children:[e.jsx(z,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),e.jsx(h,{className:"text-gray-800 dark:text-gray-200",children:"Cette activité a été évaluée et ne peut pas être re-soumise."})]}),r&&r.feedback&&e.jsxs("div",{className:"mt-8 rounded-lg border border-green-200 bg-green-50 p-6 dark:border-green-900 dark:bg-green-950",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-green-900 dark:text-green-200",children:"Retour de l'enseignant"}),e.jsx("p",{className:"text-green-800 dark:text-green-200",children:r.feedback}),r.feedback_details&&e.jsx("div",{className:"mt-4 rounded bg-white/50 p-4 dark:bg-gray-800/50",children:e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:r.feedback_details})})]})]})})}export{Ft as default};

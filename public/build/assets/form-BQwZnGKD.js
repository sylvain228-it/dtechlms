import{u as E,b as P,r as o,R as W,j as t,a as D}from"./app-klcUL3EL.js";import{I as r,T as S,S as n,C as l}from"./form-CvObqJ4P.js";import{S as T}from"./spinner-2t8r_D1R.js";import{o as M,z as V,u as U,J as $,E as J,K,L as Y}from"./type-BKOnXlFr.js";import{T as Q}from"./tags-input-DPt0DYPv.js";import{B as F}from"./button-Bh8WI1Ty.js";import{T as X}from"./teacher-layouts-iHncLP1a.js";import{a as Z}from"./tasks-akZpNf8L.js";import{g as ee}from"./index-BSbDLIwT.js";import{u as ae,a as te}from"./index-CU8SWGOj.js";import ie from"./text-editor-D61F96I-.js";import"./app-Ci7uHgFL.js";import"./utils-e8IeQt0G.js";import"./createLucideIcon-DknjQr1d.js";import"./index-hw-50Y8m.js";import"./index-C7Q-OePl.js";import"./index-Ds5qzORP.js";import"./index-DATr0Fl4.js";import"./index-D7xMndjq.js";import"./index-DkAn70oM.js";import"./index-BrvB-LOg.js";import"./index-C9hgHX-E.js";import"./index-CPeTD8AP.js";import"./index-qHu87rw-.js";import"./index-i6Jdpg_i.js";import"./iconBase-BVw07lCS.js";import"./index-A7wesXx6.js";import"./index-CyaJm5Nq.js";import"./page-banner-DONW1mv1.js";import"./index-BqTge0le.js";import"./index-CMWG4mbA.js";import"./index-BQcbsxov.js";import"./arrow-left-DMV9iy1g.js";import"./app-logo-icon-ijSwabQD.js";import"./user-profile-trigger-BnF5rMVz.js";import"./sun-UD3V7mlH.js";import"./avatar-BdB_hIma.js";import"./avatar-fallback-BDH5mD5T.js";import"./use-initials-GDEZD6-s.js";import"./divider-Dzwd8ovy.js";import"./profile-svg-BWG5dZ33.js";import"./dropdown-menu-Buaj86n5.js";import"./check-9HY1vcbG.js";import"./logout-user-CTkV5_42.js";import"./index-wHDUIrgA.js";import"./index-v3lNCs8j.js";import"./index-DGvaH1zc.js";import"./log-out-uPqsp4v0.js";import"./index-ClAXPadg.js";import"./index-DMEIf3eg.js";import"./index-B5Wz6g3U.js";import"./index-B_X-8rh8.js";import"./index-D-fKvoRm.js";import"./index-Drn0ezkX.js";import"./index-DmWZapw3.js";import"./gauge-BODaeFnF.js";import"./calendar-CUp6x8Fo.js";import"./book-open-qbgfrGvc.js";import"./settings-C4I39P2J.js";import"./x-DGooslga.js";import"./menu-CTQlVSPW.js";import"./lexical-headless-BoxOyP-N.js";import"./nodes-CfCS7w2W.js";import"./index-DH9SVvWg.js";import"./index-CJeVcETn.js";import"./index-BD3HuK-g.js";import"./index-C4OL-TuX.js";import"./index-Bwrcs2qz.js";import"./index-DerrCcFj.js";import"./editor-1mVTiBqv.js";import"./tooltip-BfRZZUzk.js";import"./index-CNnHLPwR.js";import"./content-editable-k0U21XP-.js";import"./dialog-CgQ1vonM.js";import"./index-DTV9AGlb.js";import"./command-DZlE8gfH.js";import"./search-lzJ3zhHt.js";import"./input-DzuxS5O4.js";import"./label-W6XNthsN.js";import"./popover-YHBFhHiO.js";import"./trash-C-FiMWHJ.js";import"./separator-Dhwn2oUZ.js";import"./index-Y2kYg-Ir.js";import"./index-CJQLk1SD.js";import"./chevron-up-xXppIf4P.js";import"./chevron-down-BwnMHMwc.js";import"./list-BtZo7ljf.js";import"./image-dVCsMYpd.js";const se={lecture:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},discussion:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!0,allowGroupWork:!0},quiz:{canBeEvaluated:!0,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},exercise:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},project:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},assessment:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0}};function Ga(){const{course:m,activity:s,c_modality:C,nextOrder:R}=E().props,{errors:p}=E().props;console.log("error",p);const d=!!s,{data:e,setData:i}=P({parent_course_id:m.id,course_id:s?.course_id??"",module_id:s?.module_id??"",sequence_id:s?.sequence_id??"",title:s?.title??"",description:s?.description??"",activity_type:s?.activity_type??"",order:s?.order??"",estimated_minutes:s?.estimated_minutes??null,scope:s?.scope??"",modality:s?.modality??m.modality,is_individual:!!s?.is_individual,is_collaborative:!!s?.is_collaborative,max_group_size:s?.max_group_size??null,has_deliverable:!!s?.has_deliverable,deliverable_type:s?.deliverable_type??"",deliverable_deadline:s?.deliverable_deadline??null,is_evaluated:!!s?.is_evaluated,evaluation_type:s?.evaluation_type??"",evaluation_weight:s?.evaluation_weight??null,note_unit:s?.note_unit??"",allow_late_submission:!!s?.allow_late_submission,late_penalty_percentage:s?.late_penalty_percentage??null,lock_after_end:!!s?.lock_after_end,requires_feedback:!!s?.requires_feedback,allows_resubmission:!!s?.allows_resubmission,max_attempts:s?.max_attempts??null,is_synchronous:!!s?.is_synchronous,start_at:s?.start_at?new Date(s.start_at).toISOString().slice(0,16):null,allowed_tools:d&&s?.allowed_tools!=null?JSON.parse(s?.allowed_tools):[],feedback_instructions:s?.feedback_instructions??"",duration_minutes:s?.duration_minutes??null,conference_platform:s?.conference_platform??"",conference_url:s?.conference_url??"",conference_meeting_id:s?.conference_meeting_id??"",conference_passcode:s?.conference_passcode??"",attendance_required:s?.attendance_required,is_mandatory:s?.is_mandatory,is_visible:s?.is_visible??!0}),[_,v]=o.useState(!1),c=o.useMemo(()=>e.activity_type?se[e.activity_type]:null,[e.activity_type]);o.useEffect(()=>{!c?.canBeEvaluated&&e.is_evaluated&&(i("is_evaluated",!1),i("evaluation_type",""),i("evaluation_weight",null))},[e.is_evaluated,c?.canBeEvaluated,i]),o.useEffect(()=>{e.activity_type=="assessment"&&i("is_evaluated",!0)},[e.is_evaluated,e.activity_type,i]),o.useEffect(()=>{!c?.canHaveDeliverable&&e.has_deliverable&&(i("has_deliverable",!1),i("deliverable_type",""),i("deliverable_deadline",null))},[e.has_deliverable,c?.canHaveDeliverable,i]),o.useEffect(()=>{e.is_collaborative&&i("is_individual",!1),e.is_individual&&(i("is_collaborative",!1),i("max_group_size",null))},[e.is_collaborative,e.is_individual,i]),o.useEffect(()=>{e.attendance_required&&i("is_mandatory",!0)},[e.attendance_required,i]),o.useEffect(()=>{e.activity_type=="discussion"&&(i("is_individual",!1),i("is_collaborative",!0))},[e.activity_type,i]);const B=e.is_collaborative,L=e.is_evaluated,A=e.allows_resubmission,I=e.modality=="online"||e.modality=="hybrid",[O,k]=W.useState(!1),[h,y]=o.useState([]),[g,x]=o.useState([]);async function G(a){if(y([]),x([]),i("module_id",""),i("sequence_id",""),a=="course"){i("course_id",m.id),i("order",R??"");return}i("course_id","");try{k(!0);const u=await(await fetch(`${ee(m.slug).url}?scope=${a.toLowerCase()}`,{method:"GET"})).json();if(console.log("result",u),k(!1),u.status==200){const j=[];for(const N of u.data)j.push({key:N.id,value:N.title??N.name});i("order",u.nextOrder),a=="module"?(y(j),x([])):a=="sequence"&&(x(j),y([]))}else console.error("Donnée non trouvé"),console.error("result.message",u.message)}catch(b){console.error("Erreur",b)}}const q=a=>{a.preventDefault(),v(!0);async function b(){await Z(d?s?.id:0).then(()=>{const u={...e,_method:d?"put":"post"};i("is_synchronous",f),d&&s?D.put(ae([m.slug,s.id]),u,{onFinish:()=>v(!1)}):D.post(te(m.slug),u,{onFinish:()=>v(!1)})})}b()};function H(a){a.preventDefault(),q(a)}const f=e.modality&&e.modality!="asynchronous",w=!!(e.title&&e.activity_type&&e.modality&&(!f||e.start_at&&e.duration_minutes)&&(!e.is_evaluated||e.evaluation_type)&&(!e.has_deliverable||e.deliverable_type)),z=h.length>0||g.length>0||e.scope=="course";return t.jsx(X,{title:d?"Modifier activité":"Nouvelle activité",children:t.jsxs("div",{className:"mx-auto mt-8 max-w-4xl",children:[t.jsxs("div",{className:"mb-5 flex items-center justify-between border-b p-3",children:[t.jsx("h2",{className:"mb-4 text-lg font-semibold",children:d?"Modifier l'activité":"Nouvelle activité"}),t.jsxs(F,{className:"btn-primary",disabled:_||!w,onClick:H,children:[_&&t.jsx(T,{}),"Enregistrer"]})]}),t.jsxs("form",{onSubmit:q,className:"rounded-lg border bg-white p-3 shadow sm:p-6",children:[t.jsx("div",{className:"mb-2",children:t.jsx(r,{label:"Titre",value:e.title,onChange:a=>i("title",a),error:p.title,required:!0})}),t.jsx("div",{className:"mb-2",children:t.jsx(S,{label:"Description",rows:3,value:e.description,onChange:a=>i("description",a),error:p.description})}),t.jsx("div",{className:"mb-4",children:t.jsx(n,{label:"Type d'activité",value:e.activity_type,onChange:a=>i("activity_type",a),options:M,required:!0})}),t.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-6 sm:grid-cols-2",children:[t.jsx(n,{label:"Portée",value:e.scope,disabled:O,onChange:a=>{i("scope",a),a!=e.scope&&G(a)},options:V,required:!0}),C!="asynchronous"&&t.jsx(n,{label:"Mode de déroulement",value:e.modality,onChange:a=>i("modality",a),options:U,required:!0})," "]}),z&&t.jsxs("fieldset",{className:"my-5 rounded border border-gray-200 p-4",children:[t.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Organisation dans le cours"}),h.length>0&&t.jsx("div",{className:"my-2",children:t.jsx(n,{label:"Liste des modules",emptyOption:"Sélectionner un module",value:e.module_id.toString(),onChange:a=>i("module_id",Number(a)),options:h,required:!0})}),g.length>0&&t.jsx("div",{className:"my-2",children:t.jsx(n,{label:"Liste des séquences",emptyOption:"Sélectionner une séquence",value:e.sequence_id.toString(),onChange:a=>i("sequence_id",Number(a)),options:g,required:!0})}),e.course_id!=""&&e.scope=="course"&&t.jsx("div",{className:"text-md my-2 block rounded-sm border bg-gray-100/50 p-2 font-bold text-gray-600 sm:text-xl",children:m.title}),t.jsx("div",{className:"mt-3",children:t.jsx(r,{label:"Ordre",type:"number",required:!0,value:e.order??"",onChange:a=>i("order",Number(a))})})]}),c?.canBeEvaluated&&t.jsx(l,{label:"Activité évaluée",checked:e.is_evaluated,onChange:a=>{e.activity_type!="assessment"&&i("is_evaluated",a)}}),e.is_evaluated&&t.jsx("div",{className:"my-6 rounded border bg-gray-50 p-4",children:L&&t.jsxs("div",{className:"mt-2 grid gap-2",children:[t.jsx(n,{label:"Type d'évaluation",value:e.evaluation_type,onChange:a=>i("evaluation_type",a),options:$}),t.jsx(n,{label:"Unité de notation",value:e.note_unit??"fr",onChange:a=>i("note_unit",a),options:J,required:!0,error:p.note_unit}),t.jsx(r,{label:`Poids (${e.note_unit})`,type:"number",value:e.evaluation_weight??"",onChange:a=>i("evaluation_weight",a?Number(a):null)})]})}),c?.canHaveDeliverable&&t.jsx(l,{label:"Soumission requise",checked:e.has_deliverable,onChange:a=>i("has_deliverable",a)}),e.has_deliverable&&t.jsxs("div",{className:"my-6",children:[t.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[t.jsx(n,{label:"Type de soumission",value:e.deliverable_type,onChange:a=>i("deliverable_type",a),options:K,required:!0}),t.jsx(r,{label:"Date limite",type:"datetime-local",value:e.deliverable_deadline??"",onChange:a=>i("deliverable_deadline",a)})]}),t.jsxs("div",{className:"mt-4 flex gap-3",children:[t.jsx(l,{label:"Re soumission",checked:e.allows_resubmission,onChange:a=>i("allows_resubmission",a)}),A&&t.jsx(r,{label:"Nombre maximum",type:"number",value:e.max_attempts??"",onChange:a=>i("max_attempts",a?Number(a):null)})]}),t.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[t.jsx(l,{label:"Autoriser soumission tardive",checked:!!e.allow_late_submission,onChange:a=>i("allow_late_submission",a)}),e.allow_late_submission&&t.jsx("div",{className:"mb-4",children:t.jsx(r,{label:"Pénalité tardive (%)",type:"number",value:e.late_penalty_percentage??"",onChange:a=>i("late_penalty_percentage",a?Number(a):null),error:p.late_penalty_percentage,placeholder:"ex: 10"})})]}),t.jsx("div",{className:"mb-4",children:t.jsx(l,{label:"Verrouiller après la fin",checked:!!e.lock_after_end,onChange:a=>i("lock_after_end",a)})})]}),c?.allowGroupWork&&e.activity_type!="discussion"&&t.jsx("div",{children:t.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[t.jsxs("div",{className:"flex gap-4",children:[!e.is_collaborative&&t.jsx(l,{label:"Individuel",checked:e.is_individual,onChange:a=>i("is_individual",a)}),!e.is_individual&&t.jsx(l,{label:"Collaboratif",checked:e.is_collaborative,onChange:a=>i("is_collaborative",a)})]}),B&&t.jsx(r,{label:"Taille max du groupe",type:"number",value:e.max_group_size??"",onChange:a=>i("max_group_size",a?Number(a):null)})]})}),C!="asynchronous"&&e.modality&&e.modality!="asynchronous"&&t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:[t.jsx(r,{label:"Début",required:!0,type:"datetime-local",value:e.start_at??"",onChange:a=>i("start_at",a)}),t.jsx(r,{label:"Durée (min)",type:"number",required:!0,value:e.duration_minutes??"",onChange:a=>i("duration_minutes",a?Number(a):null)})]}),I&&t.jsx("div",{children:t.jsxs("div",{className:"mt-6 grid gap-2 rounded border bg-gray-50 p-4",children:[t.jsx("h3",{className:"mb-3 font-semibold",children:"Visioconférence"}),t.jsx(n,{label:"Plateforme",value:e.conference_platform,onChange:a=>i("conference_platform",a),options:Y,required:!0}),t.jsx(r,{label:"URL",required:!0,value:e.conference_url,onChange:a=>i("conference_url",a)}),t.jsx(r,{label:"Meeting ID",value:e.conference_meeting_id,onChange:a=>i("conference_meeting_id",a)}),t.jsx(r,{label:"Code",value:e.conference_passcode,onChange:a=>i("conference_passcode",a)})]})})]}),t.jsxs("fieldset",{className:"my-5 rounded border border-gray-200 p-4",children:[t.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Ressources et outils"}),t.jsx("div",{className:"mb-4",children:t.jsx(Q,{label:"Outils autorisés",value:e.allowed_tools,onChange:a=>i("allowed_tools",a),placeholder:"ex: Calculatrice, dictionnaire, etc."})})]}),t.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.modality!="asynchronous"&&t.jsx(l,{label:"Présence obligatoire",checked:e.attendance_required,onChange:a=>i("attendance_required",a)}),e.modality=="asynchronous"&&t.jsx(l,{label:"Est Obligatoire",checked:e.is_mandatory,onChange:a=>i("is_mandatory",a)}),t.jsx(l,{label:"Activité en temps réel",checked:f,onChange:()=>null})]}),t.jsxs("div",{className:"my-6 grid gap-3 sm:grid-cols-2",children:[c?.canRequestFeedback&&t.jsxs("fieldset",{className:"mb-6 rounded border border-gray-200 p-4",children:[t.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Retour d'information"}),t.jsxs("div",{className:"my-3",children:[" ",t.jsx(l,{label:"Feedback enseignant requis.",checked:e.requires_feedback,onChange:a=>i("requires_feedback",a)})]}),t.jsx("div",{className:"mb-4",children:t.jsx(S,{label:"Instructions pour les retours",value:e.feedback_instructions??"",onChange:a=>i("feedback_instructions",a),rows:3,placeholder:"Directives pour la fourniture de retours",error:p.feedback_instructions})})]}),t.jsx(l,{label:"Visible",checked:e.is_visible==!0,onChange:a=>i("is_visible",a)})]}),t.jsxs("div",{className:"my-6",children:[t.jsx("h3",{className:"mb-3 text-2xl font-semibold",children:"Ressources pédagogiques"}),t.jsx(ie,{isNew:!d}),t.jsx("p",{className:"text-xs text-red-500",children:p.resources_summary})]}),t.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t pt-4",children:[t.jsx("button",{type:"button",onClick:()=>history.back(),className:"rounded border px-4 py-2",children:"Annuler"}),t.jsxs(F,{type:"submit",className:"btn-primary",disabled:_||!w,children:[_&&t.jsx(T,{}),d?"Enregistrer":"Ajouter l'activité"]})]})]})]})})}export{Ga as default};

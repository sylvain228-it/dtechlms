import{u as E,b as U,r as d,R as $,j as i,a as F}from"./app-BzXwBPBx.js";import{I as s,T as R,S as c,C as o}from"./form-B-fdkg48.js";import{S as L}from"./spinner-CIZwnsdn.js";import{q as J,D as Y,v as K,S as Q,M as X,T as Z,U as ee,b as ie,c as ae,V as te}from"./type-DhUEUhhk.js";import{D as le}from"./divider-B09NDvil.js";import{T as re}from"./tags-input-B-TrG92r.js";import{B as q}from"./button-DpCkL2lj.js";import{T as se}from"./teacher-layouts-C7E0jZE8.js";import{a as oe}from"./tasks-BTAmnlgm.js";import{j as ne}from"./index-Ch72Gdeg.js";import{u as de,a as ce}from"./index-CU8SWGOj.js";import ue from"./text-editor-BXdr65je.js";import{T as me}from"./trash-2-BNIFS4ij.js";import"./app-BlAWqAGg.js";import"./utils-e8IeQt0G.js";import"./createLucideIcon-BboBuA9R.js";import"./index-VdYImSg5.js";import"./index-BWbkfBfC.js";import"./index-CmvPZPYG.js";import"./index-BZwf-zK1.js";import"./index-CJlYDfk2.js";import"./index-B2cDW95s.js";import"./index-DAHL75PX.js";import"./index-BQPF0Rq9.js";import"./index-BucdvD4Q.js";import"./index-BRTuzqyl.js";import"./index-CoBc6tAl.js";import"./iconBase-BH9TG5R0.js";import"./index-D1DaFm8C.js";import"./index-CyaJm5Nq.js";import"./page-banner-CF78MDYO.js";import"./index-BqTge0le.js";import"./index-CMWG4mbA.js";import"./index-DF2umSuw.js";import"./arrow-left-AHTPeAno.js";import"./app-logo-icon-C2LaG9_Q.js";import"./user-profile-trigger-Dk_TTr5J.js";import"./sun-D7S3RfEj.js";import"./avatar-BR3sBMG9.js";import"./avatar-fallback-D5NPW7a4.js";import"./use-initials-GDEZD6-s.js";import"./profile-svg-DwoHoZ6q.js";import"./dropdown-menu-DlZS67It.js";import"./check-BHZKRPmL.js";import"./logout-user-Ce_sIJue.js";import"./index-wHDUIrgA.js";import"./index-v3lNCs8j.js";import"./index-DGvaH1zc.js";import"./log-out-BkvcRscv.js";import"./index-Vl0f8Y-f.js";import"./index-DMEIf3eg.js";import"./index-BemDBUNW.js";import"./index-CQybyuYf.js";import"./index-B_X-8rh8.js";import"./index-D-fKvoRm.js";import"./index-BGGtLgwn.js";import"./index-DXuqG7by.js";import"./gauge-Cjf8cet3.js";import"./calendar-BjFjFj4e.js";import"./book-open-DAOtQgtK.js";import"./settings-NUZ-cO65.js";import"./x-BWOBLZ9u.js";import"./menu-CWhsNS-k.js";import"./lexical-headless-DaF8M3S2.js";import"./nodes-CSrlFqt9.js";import"./index-DH9SVvWg.js";import"./index-CJeVcETn.js";import"./index-BD3HuK-g.js";import"./index-C4OL-TuX.js";import"./index-Bwrcs2qz.js";import"./index-DerrCcFj.js";import"./index-DqzhMcYD.js";import"./editor-CtaAfrVO.js";import"./tooltip-4iVuFll3.js";import"./index-BzRNNGYp.js";import"./content-editable-ByXDa-st.js";import"./dialog-BPFiSOET.js";import"./index-ti3WiRrV.js";import"./command-DSYCSJsJ.js";import"./search-N_1dfqU-.js";import"./input-Dbi88rSi.js";import"./label-D5CJeCuB.js";import"./popover-DYCgjmhj.js";import"./trash-EdiUFurY.js";import"./separator-KQUxJ4_U.js";import"./index-QfX0IA0x.js";import"./index-BtFGMy8Q.js";import"./chevron-up-CefL2SWm.js";import"./chevron-down-eKEbewAb.js";import"./list-DzzLKJvF.js";import"./image-Gtj0aFvc.js";import"./plus-B-26VCmn.js";const _e={lecture:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},discussion:{canBeEvaluated:!1,canHaveDeliverable:!1,canRequestFeedback:!0,allowGroupWork:!0},quiz:{canBeEvaluated:!0,canHaveDeliverable:!1,canRequestFeedback:!1,allowGroupWork:!1},exercise:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},project:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0},assessment:{canBeEvaluated:!0,canHaveDeliverable:!0,canRequestFeedback:!0,allowGroupWork:!0}};function Xi(){const{course:p,activity:l,c_modality:w,nextOrder:B}=E().props,{errors:r}=E().props,u=!!l,{data:e,setData:t}=U({parent_course_id:p.id,course_id:l?.course_id??"",module_id:l?.module_id??"",sequence_id:l?.sequence_id??"",title:l?.title??"",description:l?.description??"",activity_type:l?.activity_type??"",order:l?.order??"",estimated_minutes:l?.estimated_minutes??null,scope:l?.scope??"",modality:l?.modality??p.modality,is_individual:!!l?.is_individual,is_collaborative:!!l?.is_collaborative,max_group_size:l?.max_group_size??null,has_deliverable:!!l?.has_deliverable,deliverable_deadline:l?.deliverable_deadline?new Date(l.deliverable_deadline).toISOString().slice(0,16):null,deliverable_count:l?.deliverable_count??1,deliverable_type:"",allow_deliverable_file_type:"",deliverable_title:"",deliverable_max_size:1,deliverable_types:"",deliverable_requirements:u?l?.deliv_requirements??[]:[],is_evaluated:!!l?.is_evaluated,evaluation_type:l?.evaluation_type??"",evaluation_weight:l?.evaluation_weight??null,evaluation_max_weight:l?.evaluation_max_weight??null,note_unit:l?.note_unit??"",allow_late_submission:!!l?.allow_late_submission,late_penalty_percentage:l?.late_penalty_percentage??null,lock_after_end:!!l?.lock_after_end,requires_feedback:!!l?.requires_feedback,allows_resubmission:!!l?.allows_resubmission,max_attempts:l?.max_attempts??null,is_synchronous:!!l?.is_synchronous,start_at:l?.start_at?new Date(l.start_at).toISOString().slice(0,16):null,allowed_tools:u&&l?.allowed_tools!=null?JSON.parse(l?.allowed_tools):[],feedback_instructions:l?.feedback_instructions??"",duration_minutes:l?.duration_minutes??null,conference_platform:l?.conference_platform??"",conference_url:l?.conference_url??"",conference_meeting_id:l?.conference_meeting_id??"",conference_passcode:l?.conference_passcode??"",attendance_required:l?.attendance_required,is_mandatory:l?.is_mandatory,is_visible:l?.is_visible??!0});console.log("req ",l?.deliv_requirements);const[b,v]=d.useState(!1),m=d.useMemo(()=>e.activity_type?_e[e.activity_type]:null,[e.activity_type]);d.useEffect(()=>{!m?.canBeEvaluated&&e.is_evaluated&&(t("is_evaluated",!1),t("evaluation_type",""),t("evaluation_weight",null))},[e.is_evaluated,m?.canBeEvaluated,t]),d.useEffect(()=>{e.activity_type=="assessment"&&t("is_evaluated",!0)},[e.is_evaluated,e.activity_type,t]),d.useEffect(()=>{!m?.canHaveDeliverable&&e.has_deliverable&&(t("has_deliverable",!1),t("deliverable_deadline",null))},[e.has_deliverable,m?.canHaveDeliverable,t]),d.useEffect(()=>{e.is_collaborative&&t("is_individual",!1),e.is_individual&&(t("is_collaborative",!1),t("max_group_size",null))},[e.is_collaborative,e.is_individual,t]),d.useEffect(()=>{e.attendance_required&&t("is_mandatory",!0)},[e.attendance_required,t]),d.useEffect(()=>{e.activity_type=="discussion"&&(t("is_individual",!1),t("is_collaborative",!0))},[e.activity_type,t]);const z=e.is_collaborative,O=e.is_evaluated,I=e.allows_resubmission,A=e.modality=="online"||e.modality=="hybrid",[G,C]=$.useState(!1),[h,x]=d.useState([]),[y,g]=d.useState([]);async function M(a){if(x([]),g([]),t("module_id",""),t("sequence_id",""),a=="course"){t("course_id",p.id),t("order",B??"");return}t("course_id","");try{C(!0);const _=await(await fetch(`${ne(p.slug).url}?scope=${a.toLowerCase()}`,{method:"GET"})).json();if(console.log("result",_),C(!1),_.status==200){const j=[];for(const N of _.data)j.push({key:N.id,value:N.title??N.name});t("order",_.nextOrder),a=="module"?(x(j),g([])):a=="sequence"&&(g(j),x([]))}else console.error("Donnée non trouvé"),console.error("result.message",_.message)}catch(n){console.error("Erreur",n)}}const k=a=>{a.preventDefault(),v(!0);async function n(){await oe(u?l?.id??0:0).then(()=>{t("is_synchronous",f);const _={...e,allowed_tools:JSON.stringify(e.allowed_tools),deliverable_requirements:JSON.stringify(e.deliverable_requirements)};u&&l?F.put(de([p.slug,l.id]),_,{onFinish:()=>v(!1)}):F.post(ce(p.slug),_,{onFinish:()=>{v(!1),console.log("errors",r)}})})}n()};function H(a){a.preventDefault(),k(a)}const f=e.modality&&e.modality!="asynchronous",D=!!(e.title&&e.activity_type&&e.modality&&(!f||e.start_at&&e.duration_minutes)&&(!e.is_evaluated||e.evaluation_type)&&(!e.has_deliverable||e.deliverable_requirements.length===e.deliverable_count)),W=h.length>0||y.length>0||e.scope=="course";function P(a){if(a.preventDefault(),!e.has_deliverable||!e.deliverable_title||!e.deliverable_type||e.deliverable_requirements.length===e.deliverable_count)return;let n=1;e.deliverable_requirements&&e.deliverable_requirements.length>0&&(n=e.deliverable_requirements[e.deliverable_requirements.length-1].id+1),t("deliverable_requirements",[...e.deliverable_requirements,{id:n,order:n,title:e.deliverable_title,file_type:e.deliverable_type,max_size_mb:e.deliverable_max_size,allowed_file_type:e.deliverable_type=="file"?e.allow_deliverable_file_type:void 0}])}const T=e.has_deliverable&&e.deliverable_count>0&&e.deliverable_requirements.length<e.deliverable_count,V=!!(e.has_deliverable&&e.deliverable_requirements.length>0),S=!e.deliverable_title||!e.deliverable_type||e.deliverable_type=="file"&&!e.allow_deliverable_file_type;return i.jsx(se,{title:u?"Modifier activité":"Nouvelle activité",children:i.jsxs("div",{className:"mx-auto mt-8 max-w-4xl",children:[i.jsxs("div",{className:"mb-5 flex items-center justify-between border-b p-3",children:[i.jsx("h2",{className:"mb-4 text-lg font-semibold",children:u?"Modifier l'activité":"Nouvelle activité"}),i.jsxs(q,{className:"btn-primary",disabled:b||!D,onClick:H,children:[b&&i.jsx(L,{}),"Enregistrer"]})]}),i.jsxs("form",{onSubmit:k,className:"rounded-lg border bg-white p-3 shadow sm:p-6",children:[i.jsx("div",{className:"mb-2",children:i.jsx(s,{label:"Titre",value:e.title,onChange:a=>t("title",a),error:r.title,required:!0})}),i.jsx("div",{className:"mb-2",children:i.jsx(R,{label:"Description",rows:3,value:e.description,onChange:a=>t("description",a),error:r.description})}),i.jsx("div",{className:"mb-4",children:i.jsx(c,{label:"Type d'activité",value:e.activity_type,onChange:a=>t("activity_type",a),options:J,required:!0})}),i.jsxs("div",{className:"mb-2 grid grid-cols-1 gap-6 sm:grid-cols-2",children:[i.jsx(c,{label:"Portée",value:e.scope,disabled:G,onChange:a=>{t("scope",a),a!=e.scope&&M(a)},options:Y,required:!0,error:r.scope}),w!="asynchronous"&&i.jsx(c,{label:"Mode de déroulement",value:e.modality,onChange:a=>t("modality",a),options:K,required:!0,error:r.modality})," "]}),W&&i.jsxs("fieldset",{className:"my-5 rounded border border-gray-200 p-4",children:[i.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Organisation dans le cours"}),h.length>0&&i.jsx("div",{className:"my-2",children:i.jsx(c,{label:"Liste des modules",emptyOption:"Sélectionner un module",value:e.module_id.toString(),onChange:a=>t("module_id",Number(a)),options:h,required:!0,error:r.module_id})}),y.length>0&&i.jsx("div",{className:"my-2",children:i.jsx(c,{label:"Liste des séquences",emptyOption:"Sélectionner une séquence",value:e.sequence_id.toString(),onChange:a=>t("sequence_id",Number(a)),options:y,required:!0,error:r.sequence_id})}),e.course_id!=""&&e.scope=="course"&&i.jsx("div",{className:"text-md my-2 block rounded-sm border bg-gray-100/50 p-2 font-bold text-gray-600 sm:text-xl",children:p.title}),i.jsx("div",{className:"mt-3",children:i.jsx(s,{label:"Ordre",type:"number",required:!0,value:e.order??"",onChange:a=>t("order",Number(a)),error:r.order})})]}),m?.canBeEvaluated&&i.jsx(o,{label:"Activité évaluée",checked:e.is_evaluated,onChange:a=>{e.activity_type!="assessment"&&t("is_evaluated",a)}}),e.is_evaluated&&i.jsx("div",{className:"my-6 rounded border bg-gray-50 p-4",children:O&&i.jsxs("div",{className:"mt-2 grid gap-2",children:[i.jsx(c,{label:"Type d'évaluation",value:e.evaluation_type,onChange:a=>t("evaluation_type",a),options:Q,required:!0,error:r.evaluation_type}),i.jsx(c,{label:"Unité de notation",value:e.note_unit??"fr",onChange:a=>t("note_unit",a),options:X,required:!0,error:r.note_unit}),i.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[i.jsx(s,{label:`Note maximale (${e.note_unit})`,type:"number",value:e.evaluation_max_weight??"",required:!0,onChange:a=>t("evaluation_max_weight",a?Number(a):null),error:r.evaluation_max_weight}),i.jsx(s,{label:`Moyènne (${e.note_unit})`,type:"number",required:!0,value:e.evaluation_weight??"",onChange:a=>t("evaluation_weight",a?Number(a):null),error:r.evaluation_weight})]})]})}),m?.canHaveDeliverable&&i.jsx(o,{label:"Soumission requise",checked:e.has_deliverable,onChange:a=>t("has_deliverable",a)}),e.has_deliverable&&i.jsxs("div",{className:"my-6",children:[i.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[i.jsx(s,{label:"Nombre de soumissions attendues",type:"number",value:e.deliverable_count??1,min:"1",required:!0,onChange:a=>t("deliverable_count",Number(a)),error:r.deliverable_count}),i.jsx(s,{label:"Date limite",type:"datetime-local",value:e.deliverable_deadline??"",onChange:a=>t("deliverable_deadline",a),error:r.deliverable_deadline}),i.jsxs("fieldset",{className:"mb-4 rounded border border-gray-200 p-4 shadow-md sm:col-span-2",children:[i.jsx("legend",{className:"text-sm font-medium text-gray-900",children:"Infos sur le(s) livrable(s) attendue(s)"}),r&&r.deliverable_requirements&&i.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.deliverable_requirements}),T&&i.jsxs("div",{children:[i.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:[i.jsx(s,{label:"Titre du livrable",type:"text",value:e.deliverable_title,placeholder:'ex: "Rapport de laboratoire", "Fichier de code", "Document de réflexion", etc.',required:!0,onChange:a=>t("deliverable_title",a)}),i.jsx(s,{label:"Taille maximum (en Mo)",type:"number",value:e.deliverable_max_size??1,min:"1",required:!0,onChange:a=>t("deliverable_max_size",Number(a))}),i.jsx(c,{label:"Type de soumission",value:e.deliverable_type,emptyOption:'ex: "Fichier", "Texte en ligne", "Lien vers un dépôt Git", etc.',onChange:a=>t("deliverable_type",a),options:Z,required:!0}),e.deliverable_type=="file"&&i.jsx(c,{label:"Type de fichier autorisé",value:e.allow_deliverable_file_type??"",onChange:a=>t("allow_deliverable_file_type",a),options:ee,disabled:e.deliverable_type!="file"})]}),i.jsx("button",{className:`btn-primary mt-4 ${S&&"cursor-not-allowed opacity-50"}`,onClick:P,disabled:S,children:"Ajouter un livrable attendu"})]}),V&&i.jsxs("div",{className:"mt-4",children:[T&&i.jsx(le,{}),i.jsx("h3",{className:"mb-2 text-lg font-semibold",children:"Livrables attendus"}),e.deliverable_requirements.map(a=>i.jsx("div",{className:"p- mb-2 rounded border bg-gray-100 p-3 shadow-sm",children:i.jsxs("div",{className:"flex flex-wrap items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:a.title}),i.jsxs("p",{className:"text-sm text-gray-600",children:["Type:"," ",ie(a.file_type)]}),a.file_type=="file"&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Fichier autorisé :"," ",ae(a.allowed_file_type)]}),a.max_size_mb&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Taille max:"," ",a.max_size_mb," ","Mo"]})]}),i.jsx(q,{variant:"destructive",onClick:()=>{t("deliverable_requirements",e.deliverable_requirements.filter(n=>n.id!==a.id))},children:i.jsx(me,{className:"h-4 w-4"})})]})},a.id))]})]})]}),i.jsxs("div",{className:"mt-4 flex gap-3",children:[i.jsx(o,{label:"Re soumission",checked:e.allows_resubmission,onChange:a=>t("allows_resubmission",a)}),I&&i.jsx(s,{label:"Nombre maximum",type:"number",value:e.max_attempts??"",onChange:a=>t("max_attempts",a?Number(a):null),error:r.max_attempts})]}),i.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[i.jsx(o,{label:"Autoriser soumission tardive",checked:!!e.allow_late_submission,onChange:a=>t("allow_late_submission",a)}),e.allow_late_submission&&i.jsx("div",{className:"mb-4",children:i.jsx(s,{label:"Pénalité tardive (%)",type:"number",value:e.late_penalty_percentage??"",onChange:a=>t("late_penalty_percentage",a?Number(a):null),error:r.late_penalty_percentage,placeholder:"ex: 10"})})]}),i.jsx("div",{className:"mb-4",children:i.jsx(o,{label:"Verrouiller après la fin",checked:!!e.lock_after_end,onChange:a=>t("lock_after_end",a)})})]}),m?.allowGroupWork&&e.activity_type!="discussion"&&i.jsx("div",{children:i.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[i.jsxs("div",{className:"flex gap-4",children:[!e.is_collaborative&&i.jsx(o,{label:"Individuel",checked:e.is_individual,onChange:a=>t("is_individual",a)}),!e.is_individual&&i.jsx(o,{label:"Collaboratif",checked:e.is_collaborative,onChange:a=>t("is_collaborative",a)})]}),z&&i.jsx(s,{label:"Taille max du groupe",type:"number",value:e.max_group_size??"",onChange:a=>t("max_group_size",a?Number(a):null),error:r.max_group_size})]})}),w!="asynchronous"&&e.modality&&e.modality!="asynchronous"&&i.jsxs("div",{className:"mt-6",children:[i.jsxs("div",{className:"mt-3 grid gap-3 sm:grid-cols-2",children:[i.jsx(s,{label:"Début",required:!0,type:"datetime-local",value:e.start_at??"",onChange:a=>t("start_at",a),error:r.start_at}),i.jsx(s,{label:"Durée (min)",type:"number",required:!0,value:e.duration_minutes??"",onChange:a=>t("duration_minutes",a?Number(a):null),error:r.duration_minutes})]}),A&&i.jsx("div",{children:i.jsxs("div",{className:"mt-6 grid gap-2 rounded border bg-gray-50 p-4",children:[i.jsx("h3",{className:"mb-3 font-semibold",children:"Visioconférence"}),i.jsx(c,{label:"Plateforme",value:e.conference_platform,onChange:a=>t("conference_platform",a),options:te,required:!0,error:r.conference_platform}),i.jsx(s,{label:"URL",required:!0,value:e.conference_url,onChange:a=>t("conference_url",a),error:r.conference_url}),i.jsx(s,{label:"Meeting ID",value:e.conference_meeting_id,onChange:a=>t("conference_meeting_id",a),error:r.conference_meeting_id}),i.jsx(s,{label:"Code",value:e.conference_passcode,onChange:a=>t("conference_passcode",a),error:r.conference_passcode})]})})]}),i.jsxs("fieldset",{className:"my-5 rounded border border-gray-200 p-4",children:[i.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Ressources et outils"}),i.jsx("div",{className:"mb-4",children:i.jsx(re,{label:"Outils autorisés",value:e.allowed_tools,onChange:a=>t("allowed_tools",a),placeholder:"ex: Calculatrice, dictionnaire, etc."})})]}),i.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.modality!="asynchronous"&&i.jsx(o,{label:"Présence obligatoire",checked:e.attendance_required,onChange:a=>t("attendance_required",a)}),e.modality=="asynchronous"&&i.jsx(o,{label:"Est Obligatoire",checked:e.is_mandatory,onChange:a=>t("is_mandatory",a)}),i.jsx(o,{label:"Activité en temps réel",checked:f,onChange:()=>null})]}),i.jsx("div",{className:"my-6",children:m?.canRequestFeedback&&i.jsxs("fieldset",{className:"mb-6 rounded border border-gray-200 p-4",children:[i.jsx("legend",{className:"text-base font-semibold text-gray-900",children:"Retour d'information"}),i.jsxs("div",{className:"my-3",children:[" ",i.jsx(o,{label:"Feedback enseignant requis.",checked:e.requires_feedback,onChange:a=>t("requires_feedback",a)})]}),i.jsx("div",{className:"mb-4",children:i.jsx(R,{label:"Instructions pour les retours",value:e.feedback_instructions??"",onChange:a=>t("feedback_instructions",a),rows:3,placeholder:"Directives pour la fourniture de retours",error:r.feedback_instructions})})]})}),i.jsx(o,{label:"Visible",checked:e.is_visible==!0,onChange:a=>t("is_visible",a)}),i.jsxs("div",{className:"my-6",children:[i.jsx("h3",{className:"mb-3 text-2xl font-semibold",children:"Ressources pédagogiques"}),i.jsx(ue,{isNew:!u}),i.jsx("p",{className:"text-xs text-red-500",children:r.resources_summary})]}),i.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3 border-t pt-4",children:[i.jsx("button",{type:"button",onClick:()=>history.back(),className:"rounded border px-4 py-2",children:"Annuler"}),i.jsxs(q,{type:"submit",className:"btn-primary",disabled:b||!D,children:[b&&i.jsx(L,{}),u?"Enregistrer":"Ajouter l'activité"]})]})]})]})})}export{Xi as default};

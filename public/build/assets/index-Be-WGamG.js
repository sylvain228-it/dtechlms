import{c as We,u as Xe,r as G,j as t,L as ve,a as qe,H as Ye}from"./app-BOmU1wmL.js";import{I as Ze,S as et}from"./form-Cdl3Pe45.js";import{B as x}from"./button-BXeYMGgI.js";import{a as tt,b as st,c as lt,e as it,g as rt,f as ct}from"./dialog-4kNTCLrK.js";import{S as ze}from"./spinner--AHlGxP7.js";import{f as Be,r as nt}from"./type-DDACwUq3.js";import{s as He}from"./utils-e8IeQt0G.js";import{v as at}from"./index-BqTge0le.js";import{c as ot,a as dt,e as Pe,d as $e,b as Qe}from"./index-DWLCbCLc.js";import{a as mt}from"./index-CrUFx6LV.js";import ft from"./medias-layout-4pnCHlZ1.js";import"./app-VvtKnDwK.js";import"./index-sq8JxwLA.js";import"./index-CtUadT9n.js";import"./index-CyaJm5Nq.js";import"./index-CTyL-A3x.js";import"./index-DdNxHDY2.js";import"./index-BdIQ-kbR.js";import"./index-CXwkwjvO.js";import"./index-C6gdkV91.js";import"./x-Cxqud0xV.js";import"./createLucideIcon-DUOuwx2-.js";import"./index-CMWG4mbA.js";import"./iconBase-CPalTnLO.js";import"./page-banner-C7OHPqMr.js";import"./index-fxZgv_cA.js";import"./arrow-left-CgAHiiqU.js";function $t(){const e=We.c(130),{allMedias:f,entityResources:be,entity_type:r,entity_id:c}=Xe().props,[m,Ae]=G.useState(""),[u,Ie]=G.useState(void 0),[p,Ge]=G.useState("grid");let K;e[0]===Symbol.for("react.memo_cache_sentinel")?(K={},e[0]=K):K=e[0];const[a,ye]=G.useState(K),[l,W]=G.useState(null),[d,Ne]=G.useState(!1);let X;e[1]!==f||e[2]!==be||e[3]!==c||e[4]!==r?(X=r==null||c==null?f:be.map(gt),e[1]=f,e[2]=be,e[3]=c,e[4]=r,e[5]=X):X=e[5];const Se=X;let h;e[6]!==Se?(h=Se||[],e[6]=Se,e[7]=h):h=e[7];let Y;if(e[8]!==m||e[9]!==h||e[10]!==u){let s;e[12]!==m||e[13]!==u?(s=i=>{if(u&&i.resource_type!==u)return!1;if(!m)return!0;const n=m.toLowerCase();return(i.title||"").toLowerCase().includes(n)||(i.slug||"").toLowerCase().includes(n)||(i.mime_type||"").toLowerCase().includes(n)},e[12]=m,e[13]=u,e[14]=s):s=e[14],Y=h.filter(s),e[8]=m,e[9]=h,e[10]=u,e[11]=Y}else Y=e[11];const o=Y;let Z;e[15]===Symbol.for("react.memo_cache_sentinel")?(Z=function(i){i&&ye(n=>({...n,[i]:!n[i]}))},e[15]=Z):Z=e[15];const Oe=Z;let ee;e[16]!==o||e[17]!==a?(ee=function(){const i=o.every(J=>a[J.id||0]),n={};o.forEach(J=>{n[J.id||0]=!i}),ye(n)},e[16]=o,e[17]=a,e[18]=ee):ee=e[18];const _e=ee;let te;e[19]===Symbol.for("react.memo_cache_sentinel")?(te=function(){Ne(!1)},e[19]=te):te=e[19];const Ve=te;let se;e[20]!==c||e[21]!==r?(se=async function(i){if(!i||!confirm("Supprimer ce média ?"))return;const n=r&&c?$e([i,r,c]).url:Qe(i).url;Ne(!0),await qe.delete(n,{onFinish:Ve,onError:ht})},e[20]=c,e[21]=r,e[22]=se):se=e[22];const we=se;let le;e[23]!==c||e[24]!==r||e[25]!==a?(le=async function(){const i=Object.entries(a).filter(xt).map(pt);if(!i.length)return alert("Aucun média sélectionné");if(confirm(`Supprimer ${i.length} médias ?`)){Ne(!0);for(const n of i){const J=r&&c?$e([n,r,c]).url:Qe(n).url;await qe.delete(J,{onFinish:Ve,onError:ut})}ye({})}},e[23]=c,e[24]=r,e[25]=a,e[26]=le):le=e[26];const Ce=le;let ie;e[27]===Symbol.for("react.memo_cache_sentinel")?(ie=async function(i){i&&(await navigator.clipboard.writeText(i),alert("URL copiée"))},e[27]=ie):ie=e[27];const Je=ie;let re;e[28]!==c||e[29]!==r?(re=r&&c?ot([r,c]):dt(),e[28]=c,e[29]=r,e[30]=re):re=e[30];const ke=re;let ce;e[31]===Symbol.for("react.memo_cache_sentinel")?(ce=function(i){return i=="jpg"||i=="jpeg"||i=="png"},e[31]=ce):ce=e[31];const Ke=ce;let ne;e[32]===Symbol.for("react.memo_cache_sentinel")?(ne=t.jsx(Ye,{title:"Médiathèque"}),e[32]=ne):ne=e[32];let g;e[33]!==ke?(g=t.jsx(x,{asChild:!0,children:t.jsx(ve,{href:ke,className:"inline-flex items-center gap-2",children:"Upload"})}),e[33]=ke,e[34]=g):g=e[34];let j;e[35]!==p?(j=()=>Ge(p==="grid"?"list":"grid"),e[35]=p,e[36]=j):j=e[36];const Fe=p==="grid"?"Vue liste":"Vue grille";let v;e[37]!==j||e[38]!==Fe?(v=t.jsx(x,{variant:"ghost",onClick:j,children:Fe}),e[37]=j,e[38]=Fe,e[39]=v):v=e[39];let b;e[40]!==d?(b=d&&t.jsx(ze,{}),e[40]=d,e[41]=b):b=e[41];let y;e[42]!==b?(y=t.jsxs("div",{className:"flex",children:[b,"Supprimer sélection"]}),e[42]=b,e[43]=y):y=e[43];let N;e[44]!==Ce||e[45]!==d||e[46]!==y?(N=t.jsx(x,{disabled:d,variant:"destructive",onClick:Ce,children:y}),e[44]=Ce,e[45]=d,e[46]=y,e[47]=N):N=e[47];let S;e[48]!==g||e[49]!==v||e[50]!==N?(S=t.jsxs("div",{className:"flex items-center gap-2",children:[g,v,N]}),e[48]=g,e[49]=v,e[50]=N,e[51]=S):S=e[51];let ae;e[52]===Symbol.for("react.memo_cache_sentinel")?(ae=s=>Ae(s),e[52]=ae):ae=e[52];let _;e[53]!==m?(_=t.jsx(Ze,{label:"",placeholder:"Rechercher par titre, ou type...",value:m,onChange:ae}),e[53]=m,e[54]=_):_=e[54];const De=u??"";let oe;e[55]===Symbol.for("react.memo_cache_sentinel")?(oe=s=>Ie(s),e[55]=oe):oe=e[55];let w;e[56]!==De?(w=t.jsx("div",{className:"min-w-[200px]",children:t.jsx(et,{options:nt,label:"",value:De,onChange:oe})}),e[56]=De,e[57]=w):w=e[57];let de;e[58]===Symbol.for("react.memo_cache_sentinel")?(de=t.jsx(x,{onClick:()=>{Ae(""),Ie(void 0)},className:"btn-primary mt-2",children:"Réinitialiser"}),e[58]=de):de=e[58];let C;e[59]!==_||e[60]!==w?(C=t.jsxs("div",{className:"flex w-full items-center gap-2 sm:w-auto",children:[_,w,de]}),e[59]=_,e[60]=w,e[61]=C):C=e[61];let k;e[62]!==S||e[63]!==C?(k=t.jsxs("div",{className:"mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[S,C]}),e[62]=S,e[63]=C,e[64]=k):k=e[64];let F;e[65]!==we||e[66]!==c||e[67]!==r||e[68]!==o||e[69]!==d||e[70]!==_e||e[71]!==a||e[72]!==p?(F=p==="grid"?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[t.jsx("input",{type:"checkbox","aria-label":"Select all",checked:o.length>0&&o.every(s=>a[s.id||0]),onChange:_e}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.length," éléments"]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:o.map(s=>t.jsxs("div",{className:"relative rounded border bg-card p-2",children:[t.jsxs("div",{className:"mb-2 flex items-start justify-between gap-2",children:[t.jsx("input",{type:"checkbox",checked:!!a[s.id||0],onChange:()=>Oe(s.id)}),t.jsxs("div",{className:"ml-auto flex gap-1",children:[t.jsx("button",{title:"Aperçu",className:"btn-ghost text-sm",onClick:()=>W(s),children:"Aperçu"}),t.jsx(ve,{className:"btn-ghost text-sm",href:Pe([s.slug,r,c]),children:"Éditer"}),t.jsx("button",{title:"Supprimer",disabled:d,className:"btn-ghost text-sm text-destructive",onClick:()=>we(s.id),children:t.jsxs("div",{className:"flex",children:[d&&t.jsx(ze,{}),"Supprimer"]})})]})]}),t.jsx("div",{className:"flex h-40 items-center justify-center overflow-hidden rounded bg-muted",children:t.jsxs("div",{children:[Ke(s.file_ext??"")&&s.url&&t.jsx("img",{src:s.url,alt:s.title,className:"h-full max-h-[300px] w-full object-cover"}),s.file_ext&&s.file_ext=="pdf"&&t.jsx(ve,{href:at(s.slug),children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[t.jsx(mt,{size:40}),t.jsx("h3",{children:"Document PDF"})]})})]})}),t.jsx("div",{className:"mt-2",children:t.jsx("div",{className:"truncate font-medium",children:s.attribution??""})})]},s.id))})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-12 gap-2 border-b p-2 font-semibold",children:[t.jsx("div",{className:"col-span-1"}),t.jsx("div",{className:"col-span-6",children:"Titre"}),t.jsx("div",{className:"col-span-2",children:"Type"}),t.jsx("div",{className:"col-span-2",children:"Taille"}),t.jsx("div",{className:"col-span-1",children:"Actions"})]}),o.map(s=>t.jsxs("div",{className:"grid grid-cols-12 items-center gap-2 rounded border p-2",children:[t.jsx("div",{className:"col-span-1",children:t.jsx("input",{type:"checkbox",checked:!!a[s.id||0],onChange:()=>Oe(s.id)})}),t.jsxs("div",{className:"col-span-6",children:[t.jsx("div",{className:"font-medium",children:s.title}),t.jsx("div",{className:"text-xs text-muted-foreground",children:s.slug})]}),t.jsx("div",{className:"col-span-2",children:Be(s.resource_type)}),t.jsx("div",{className:"col-span-2",children:He(s.file_size)}),t.jsxs("div",{className:"col-span-1 flex gap-2",children:[t.jsx("button",{className:"btn-ghost text-sm",onClick:()=>W(s),children:"Aperçu"}),t.jsx(ve,{className:"btn-ghost text-sm",href:Pe([s.slug,r,c]),children:"Éditer"})]})]},s.id))]}),e[65]=we,e[66]=c,e[67]=r,e[68]=o,e[69]=d,e[70]=_e,e[71]=a,e[72]=p,e[73]=F):F=e[73];const Me=!!l;let me;e[74]===Symbol.for("react.memo_cache_sentinel")?(me=s=>!s&&W(null),e[74]=me):me=e[74];const Le=l?.title;let D;e[75]!==Le?(D=t.jsx(tt,{children:Le}),e[75]=Le,e[76]=D):D=e[76];const Re=l?.description;let M;e[77]!==Re?(M=t.jsx(st,{children:Re}),e[77]=Re,e[78]=M):M=e[78];let L;e[79]!==D||e[80]!==M?(L=t.jsxs(lt,{children:[D,M]}),e[79]=D,e[80]=M,e[81]=L):L=e[81];let R;e[82]!==l?(R=l?.resource_type=="image"&&l?.url?t.jsx("img",{src:l.url,alt:l.title,className:"max-h-[400px] w-full rounded object-cover"}):t.jsxs("div",{className:"rounded bg-muted p-6 text-center",children:[t.jsx("div",{className:"mb-2 font-medium",children:l?.mime_type}),t.jsx("div",{className:"text-sm text-muted-foreground",children:l?.resource_type})]}),e[82]=l,e[83]=R):R=e[83];let fe;e[84]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsx("strong",{children:"Type:"}),e[84]=fe):fe=e[84];let T;e[85]!==l?(T=l&&Be(l.resource_type),e[85]=l,e[86]=T):T=e[86];let E;e[87]!==T?(E=t.jsxs("div",{className:"text-sm",children:[fe," ",T]}),e[87]=T,e[88]=E):E=e[88];let ue;e[89]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx("strong",{children:"Taille:"}),e[89]=ue):ue=e[89];const Te=l?.file_size;let U;e[90]!==Te?(U=He(Te),e[90]=Te,e[91]=U):U=e[91];let A;e[92]!==U?(A=t.jsxs("div",{className:"text-sm",children:[ue," ",U]}),e[92]=U,e[93]=A):A=e[93];let pe;e[94]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsx("strong",{children:"Mime:"}),e[94]=pe):pe=e[94];const Ee=l?.mime_type;let I;e[95]!==Ee?(I=t.jsxs("div",{className:"text-sm",children:[pe," ",Ee]}),e[95]=Ee,e[96]=I):I=e[96];let xe;e[97]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx("strong",{children:"Créé:"}),e[97]=xe):xe=e[97];let O;e[98]!==l?(O=l?.created_at?new Date(l.created_at).toLocaleString():"",e[98]=l,e[99]=O):O=e[99];let V;e[100]!==O?(V=t.jsxs("div",{className:"text-sm",children:[xe," ",O]}),e[100]=O,e[101]=V):V=e[101];let q;e[102]!==E||e[103]!==A||e[104]!==I||e[105]!==V?(q=t.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[E,A,I,V]}),e[102]=E,e[103]=A,e[104]=I,e[105]=V,e[106]=q):q=e[106];let z;e[107]!==R||e[108]!==q?(z=t.jsxs("div",{className:"py-4",children:[R,q]}),e[107]=R,e[108]=q,e[109]=z):z=e[109];let B;e[110]!==l?.url?(B=t.jsx(x,{onClick:()=>Je(l?.url),children:"Copier l'URL"}),e[110]=l?.url,e[111]=B):B=e[111];const Ue=l?.url||"#";let he;e[112]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx(x,{children:"Ouvrir"}),e[112]=he):he=e[112];let H;e[113]!==Ue?(H=t.jsx("a",{className:"btn",href:Ue,target:"_blank",rel:"noreferrer",children:he}),e[113]=Ue,e[114]=H):H=e[114];let ge;e[115]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsx(x,{variant:"ghost",onClick:()=>W(null),children:"Fermer"}),e[115]=ge):ge=e[115];let P;e[116]!==B||e[117]!==H?(P=t.jsxs(it,{className:"flex gap-2",children:[B,H,ge]}),e[116]=B,e[117]=H,e[118]=P):P=e[118];let $;e[119]!==L||e[120]!==z||e[121]!==P?($=t.jsxs(rt,{className:"max-w-2xl",children:[L,z,P]}),e[119]=L,e[120]=z,e[121]=P,e[122]=$):$=e[122];let Q;e[123]!==Me||e[124]!==$?(Q=t.jsx(ct,{open:Me,onOpenChange:me,children:$}),e[123]=Me,e[124]=$,e[125]=Q):Q=e[125];let je;return e[126]!==k||e[127]!==F||e[128]!==Q?(je=t.jsxs(ft,{title:"Médiathèque",children:[ne,k,F,Q]}),e[126]=k,e[127]=F,e[128]=Q,e[129]=je):je=e[129],je}function ut(e){return console.log("error ",e)}function pt(e){const[f]=e;return Number(f)}function xt(e){const[,f]=e;return f}function ht(e){return console.log("error ",e)}function gt(e){return e.resource}export{$t as default};

import{u as P,r as A,R as u,b as z,j as e,H as K,a as k}from"./app-BzXwBPBx.js";import{D as O}from"./profile-svg-DwoHoZ6q.js";import{I as n,S as D,C as I}from"./form-B-fdkg48.js";import{B as p}from"./button-DpCkL2lj.js";import{b as H,I as J,a as Q}from"./input-group-eor9wxyn.js";import{S as v}from"./spinner-CIZwnsdn.js";import{u as Y}from"./use-tmp-upload-H5QVf1fd.js";import{e as W,f as X}from"./type-DhUEUhhk.js";import{u as Z,a as ee,b as re}from"./index-CwtRjVPi.js";import{C as se}from"./index-BewVzqxI.js";import{a as ae}from"./index-CdrdjxgA.js";import te from"./gest-layout-C6NIsl1n.js";import{S as le}from"./search-N_1dfqU-.js";import"./app-BlAWqAGg.js";import"./utils-e8IeQt0G.js";import"./index-D1DaFm8C.js";import"./index-CmvPZPYG.js";import"./index-CyaJm5Nq.js";import"./input-Dbi88rSi.js";import"./createLucideIcon-BboBuA9R.js";import"./index-CMWG4mbA.js";import"./iconBase-BH9TG5R0.js";import"./page-banner-CF78MDYO.js";import"./index-BqTge0le.js";import"./index-DF2umSuw.js";import"./arrow-left-AHTPeAno.js";function De(){const{errors:i}=P().props,{student:a}=P().props,[h,y]=A.useState(!1),_=a==null||a.user_id==null,[N,U]=u.useState(""),[l,x]=u.useState(void 0),[w,g]=u.useState(!1),[C,b]=u.useState(null),{data:t,setData:s,reset:R}=z({first_name:a?.first_name??"",last_name:a?.last_name??"",email:a?.email??"",create_new_user:!1,phone_number:a?.phone_number??"",whatsapp_number:a?.whatsapp_number??"",birth_date:a==null?"":a.birth_date?new Date(a.birth_date).toISOString().split("T")[0]:"",gender:a?.gender??"",current_level:a?.current_level??"",country:a?.country??"",city:a?.city??"",address:a?.address??"",is_active:a?.is_active===1,user_id:a?.user_id??"",tmp_path:""}),d=!!a,{file:f,tmpPath:S,filePreview:E,uploadProgress:c,isRemoving:j,handleFileChange:G,remove:q}=Y({onUploadSuccess:r=>s("tmp_path",r.path),onRemoveSuccess:()=>s("tmp_path","")}),L=r=>{r.preventDefault(),y(!0);async function m(){const o={...t,_method:a==null?"post":"put"};a!=null?k.post(Z(a.id),o,{forceFormData:!0,onSuccess:F}):k.post(ee(),o,{onSuccess:F})}m()};function F(){y(!1),R()}new Date().getFullYear();async function M(r){try{g(!0);const o=await(await fetch(`${re().url}?search_key=${r}`,{method:"GET"})).json();console.log("result",o),g(!1),o.user?(x(o.user),b(null)):(console.error("Utilisateur non trouvé"),console.error("result.message",o.message),b(o.message||"Utilisateur non trouvé"),x(void 0))}catch(m){b("Une erreur est survenue lors de la recherche."),g(!1),console.error("Erreur",m)}}function T(){M(N)}function B(r){r.preventDefault(),l&&(s("user_id",l.id.toString()),s("first_name",l?.first_name),s("last_name",l.last_name),s("email",l.email),s("phone_number",l.phone_number))}function $(r){r.preventDefault(),x(void 0),s("user_id",""),s("first_name",""),s("last_name",""),s("email",""),s("phone_number","")}A.useEffect(()=>s("tmp_path",S),[s,S]);const V=t.first_name&&t.last_name&&t.email&&t.phone_number;return e.jsxs(te,{title:"Fiche d'enregistrement d'étudiant",children:[e.jsx(K,{title:d?"Modifier l'Etudiant":"Ajouter un Etudiant"}),e.jsxs("div",{className:"mx-auto mt-8 mb-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Modifier l'Etudiant":"Ajouter un Etudiant"}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["Complétez le formulaire ci-dessous pour",d?" modifier un profil d'Etudiant existant":" créer un nouveau profil d'Etudiant"]})]}),e.jsxs("form",{onSubmit:L,method:"POST",className:"space-y-8 rounded-xl border border-gray-200 bg-white p-8 shadow-lg",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"mb-6 text-lg font-semibold text-gray-800",children:"Photo de Profil"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"h-24 w-24 overflow-hidden rounded-lg border-2 border-gray-300 bg-gray-100",children:E?e.jsx("img",{src:E,alt:"Aperçu",className:"h-full w-full object-cover"}):e.jsx(e.Fragment,{children:d&&a.profile_picture_url!=null?e.jsx("img",{src:a.profile_picture_url,alt:"Aperçu",className:"h-full w-full object-cover"}):e.jsx(O,{})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:G,disabled:t.tmp_path!=="",className:"hidden",id:"profile-picture"}),e.jsx("label",{htmlFor:"profile-picture",className:"inline-block cursor-pointer rounded-lg bg-blue-600 px-4 py-2 text-white transition hover:bg-blue-700",children:"Télécharger une photo"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"JPG, PNG ou GIF. Max 5MB."}),f&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:f.name}),e.jsxs(p,{disabled:j||c!==100,type:"button",onClick:q,className:"cursor-pointer text-sm text-red-600 transition hover:text-red-700 hover:underline",children:[j&&e.jsx(v,{}),e.jsx(se,{size:30})]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:"bg-cblue h-full rounded-full transition-all duration-300",style:{width:`${c}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c,"% téléchargé"]})]})]})]})]}),_&&e.jsx("div",{className:"mt-6 grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsx("h2",{className:"text-md font-medium text-gray-900",children:"Etudiant à déjà un compte?/Rechercher"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs(H,{className:"w-full rounded-3xl py-5 focus:outline-0 focus-visible:outline-0",children:[e.jsx(J,{name:"search_key",onChange:r=>U(r.target.value),placeholder:"Entrer son numéro, son email ou identifiant"}),e.jsx(Q,{align:"inline-end",children:e.jsxs(p,{disabled:w||N==="",className:"btn-primary",onClick:T,children:[w&&e.jsx(v,{}),e.jsx(le,{}),"Vérifier"]})})]})}),l&&e.jsx("div",{className:"mb-4 rounded-lg border border-gray-200 bg-gray-50 p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[l.first_name," ",l.last_name]}),e.jsx("p",{className:"text-sm text-gray-600",children:l.email}),e.jsx("p",{className:"text-sm text-gray-500",children:l.phone_number})]}),e.jsx("div",{className:"rounded-full bg-green-100 p-2",children:e.jsx("svg",{className:"h-5 w-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})}),C&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-4 shadow-sm",children:e.jsx("p",{className:"text-sm text-red-600",children:C})}),l&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{onClick:B,type:"submit",className:"btn-primary",children:"Appliquer"}),e.jsx(p,{onClick:$,type:"submit",className:"btn-primary !bg-red-500",children:e.jsx(ae,{})})]})]})]})}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"mb-6 text-lg font-semibold text-gray-800",children:"Informations Personnelles"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(n,{label:"Prénom",value:t.first_name,onChange:r=>s("first_name",r),error:i.first_name,required:!0,placeholder:"ex: Jean"}),e.jsx(n,{label:"Nom",value:t.last_name,onChange:r=>s("last_name",r),error:i.last_name,required:!0,placeholder:"ex: Dupont"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(n,{label:"Email",type:"email",value:t.email,onChange:r=>s("email",r),error:i.email,required:!0,placeholder:"ex: jean.dupont@example.com"}),e.jsx(n,{label:"Téléphone",type:"tel",value:t.phone_number,onChange:r=>s("phone_number",r),error:i.phone_number,required:!0,placeholder:"ex: +22890123456"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(n,{label:"Numéro whatsapp",type:"tel",value:t.whatsapp_number,onChange:r=>s("whatsapp_number",r),error:i.whatsapp_number,placeholder:"ex: +22890123456"}),e.jsx(n,{label:"Date de Naissance",type:"date",value:t.birth_date??"",onChange:r=>s("birth_date",r),error:i.birth_date})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4",children:e.jsx(D,{label:"Sexe",value:t.gender,onChange:r=>s("gender",r),options:W,error:i.gender})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"mb-6 text-lg font-semibold text-gray-800",children:"Qualifications Académiques"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(D,{label:"Niveau d'Études Actuel",value:t.current_level,onChange:r=>s("current_level",r),options:X,error:i.gender})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"mb-6 text-lg font-semibold text-gray-800",children:"Localisation"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:[e.jsx(n,{label:"Pays",value:t.country,onChange:r=>s("country",r),error:i.country,placeholder:"ex: Togo"}),e.jsx(n,{label:"Ville",value:t.city,onChange:r=>s("city",r),error:i.city,placeholder:"ex: Lomé"}),e.jsx(n,{label:"Adresse",value:t.address,onChange:r=>s("address",r),error:i.address,placeholder:"ex: 123 Rue de la Paix"})]})]}),e.jsxs("div",{className:"pb-6",children:[e.jsx("h2",{className:"mb-6 text-lg font-semibold text-gray-800",children:"Statut de l'Étudiant"}),e.jsx("div",{className:"space-y-4",children:e.jsx(I,{label:"Actif",checked:t.is_active,onChange:r=>s("is_active",r)})})]}),_&&e.jsx("div",{children:t.user_id!=""&&l!=null?e.jsxs("div",{className:"w-full bg-green-100 p-3 text-green-600",children:["Utilisateur trouvé : ",l.email]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full bg-amber-100 p-3 text-amber-600",children:["Un compte utilisateur n'a pas été sélectionné,"," ",e.jsx("b",{children:"cocher cette case pour créer un nouveau compte qui sera associer à cet enseignant avec ses informations."})]}),e.jsx("div",{className:"mt-2 pb-6",children:e.jsx("div",{className:"space-y-4",children:e.jsx(I,{label:"Créer un nouveau compte",checked:t.create_new_user,onChange:r=>s("create_new_user",r)})})})]})}),e.jsxs("div",{className:"flex gap-4 border-t border-gray-200 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"flex-1 rounded-lg border border-gray-300 bg-white px-6 py-2 font-medium text-gray-700 transition hover:bg-gray-50",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:h||!V||j||f&&c<100,className:"btn-primary flex items-center",children:[h&&e.jsx(v,{}),h?`${a==null?"Enregistrement en cours...":"Mise à jour en cours..."}`:`${a==null?"Créer l'Etudiant":"Modifier l'Etudiant"}`]})]})]})]})]})}export{De as default};

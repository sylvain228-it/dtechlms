import{r as t,e as U}from"./app-BOmU1wmL.js";function F(a={}){const[g,r]=t.useState(null),[s,l]=t.useState(""),[c,u]=t.useState(null),[v,i]=t.useState(0),[w,p]=t.useState(!1),[R,d]=t.useState(!1),f=t.useCallback(async e=>{if(!e)return;p(!0),r(e),u(URL.createObjectURL(e));const o=new FormData;o.append("file",e);try{const n=await U.post("/upload-to-tmp",o,{onUploadProgress:h=>{const S=Math.round(h.loaded*100/(h.total||1));i(S)}});l(n.data.path),a.onUploadSuccess?.(n.data)}catch(n){throw a.onUploadError?.(n),n}finally{p(!1)}},[a]),m=t.useCallback(async()=>{if(s){d(!0);try{const e=new FormData;e.append("tmp_path",s),await U.post("/remove-from-tmp",e),l(""),r(null),u(null),i(0),a.onRemoveSuccess?.()}catch(e){throw a.onRemoveError?.(e),e}finally{d(!1)}}},[s,a]);return t.useEffect(()=>()=>{c&&URL.revokeObjectURL(c)},[c]),{file:g,tmpPath:s,filePreview:c,uploadProgress:v,isUploading:w,isRemoving:R,handleFileChange:e=>{const o=e.target.files?.[0]??null;s&&m(),o?f(o):(r(null),u(null),l(""))},upload:f,remove:m,setTmpPath:l,setFile:r,setPreview:u}}export{F as u};
